<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÎÇòÎ¨¥ÏúÑÌÇ§ Ïä§ÌÉÄÏùº ÏóêÎîîÌÑ∞</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css" rel="stylesheet">
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --namu-green: #2db400;
            --namu-light-green: #e8f5e9;
            --namu-dark-green: #1e7e34;
            --border-color: #ddd;
            --text-color: #222;
            --bg-color: #fff;
            --table-header-bg: var(--namu-green);
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* ÏôºÏ™Ω Ìé∏Ïßë Ìå®ÎÑê */
        .editor-panel {
            width: 400px;
            background: #f8f9fa;
            border-right: 2px solid var(--border-color);
            overflow-y: auto;
            padding: 20px;
        }

        .editor-panel h2 {
            color: var(--namu-green);
            margin-bottom: 20px;
            font-size: 24px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 5px;
            color: #555;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-family: inherit;
            font-size: 14px;
        }

        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }

        .image-upload-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .image-preview {
            width: 100%;
            max-height: 200px;
            object-fit: cover;
            border-radius: 4px;
            display: none;
        }

        .image-preview.show {
            display: block;
        }

        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 20px 0;
        }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }

        .btn-primary {
            background: var(--namu-green);
            color: white;
        }

        .btn-primary:hover {
            background: var(--namu-dark-green);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #545b62;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .section-item {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 4px;
            border: 1px solid var(--border-color);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .section-type {
            font-weight: 700;
            color: var(--namu-green);
        }

        .color-theme {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid var(--border-color);
        }

        .color-input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .color-input-group input[type="color"] {
            width: 60px;
            height: 40px;
            border: none;
            cursor: pointer;
        }

        /* Ïò§Î•∏Ï™Ω ÌîÑÎ¶¨Î∑∞ Ìå®ÎÑê */
        .preview-panel {
            flex: 1;
            overflow-y: auto;
            background: var(--bg-color);
        }

        #wiki-preview {
            max-width: 1000px;
            width: 1000px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        /* ÎÇòÎ¨¥ÏúÑÌÇ§ Ïä§ÌÉÄÏùº */
        .wiki-header {
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
            margin-bottom: 10px;
        }

        .wiki-title {
            font-size: 36px;
            font-weight: 700;
            color: var(--text-color);
        }

        .wiki-meta {
            display: flex;
            gap: 15px;
            font-size: 13px;
            color: #666;
            margin-bottom: 15px;
        }

        .wiki-category {
            background: white;
            padding: 8px 0;
            margin-bottom: 15px;
            font-size: 14px;
            border: none;
        }

        .wiki-category-item {
            color: var(--namu-green);
        }

        .wiki-content {
            display: flex;
            gap: 30px;
            align-items: flex-start;
            margin-bottom: 40px;
        }

        .wiki-main {
            flex: 1;
            min-width: 0;
        }

        .wiki-full-content {
            clear: both;
            width: 100%;
        }

        .wiki-toc {
            background: white;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid #ddd;
            max-width: 190px;
        }

        .wiki-toc-title {
            font-size: 18px;
            font-weight: 700;
            color: #222;
            margin-bottom: 15px;
        }

        .wiki-toc-list {
            list-style: none;
        }

        .wiki-toc-list li {
            padding: 4px 0;
            color: #222;
        }

        .wiki-toc-list .toc-number {
            color: var(--namu-green);
            font-weight: 700;
            margin-right: 5px;
        }

        .wiki-toc-list .toc-level-2 {
            margin-left: 20px;
        }

        .wiki-toc-list .toc-level-3 {
            margin-left: 40px;
        }

        .profile-box {
            width: 350px;
            background: white;
            border: 2px solid var(--namu-green);
            overflow: hidden;
            position: sticky;
            top: 20px;
        }

        .profile-image {
            width: 100%;
            height: 350px;
            object-fit: cover;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
        }

        .profile-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-table {
            width: 100%;
            border-collapse: collapse;
        }

        .profile-table tr {
            border-bottom: 1px solid var(--border-color);
        }

        .profile-table tr:last-child {
            border-bottom: none;
        }

        .profile-table th {
            background: var(--table-header-bg);
            color: white;
            padding: 5px 10px;
            text-align: center;
            font-weight: 500;
            width: 35%;
        }

        .profile-table td {
            padding: 5px 10px;
            background: white;
        }

        .wiki-section {
            margin-bottom: 5px;
        }

        .wiki-heading {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-color);
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid #ddd;
        }

        .wiki-heading-2 {
            font-size: 24px;
            margin-top: 25px;
        }

        .wiki-heading-3 {
            font-size: 20px;
            margin-top: 20px;
            border-bottom: 1px solid #ddd;
        }

        .wiki-text {
            line-height: 1.8;
            color: var(--text-color);
            margin-bottom: 10px;
        }

        .wiki-text blockquote {
            border-left: 3px solid var(--namu-green);
            padding-left: 15px;
            margin: 0;
            color: #666;
            font-style: italic;
            display: inline-block;
        }

        .intro-table {
            width: 700px;
            max-width: 700px;
            border: none;
            border-radius: 8px;
            overflow: hidden;
            margin: 20px auto;
            border-collapse: separate;
            border-spacing: 0;
            background: var(--namu-green);
            padding: 0 0 10px;
            text-align: center;
        }

        .intro-table td {
            padding: 5px 10px;
            text-align: center;
            border: none;
        }

        .intro-table .intro-first-row {
            margin: 0;
            padding: 0;
        }

        .intro-table .intro-row1 {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            color: white;
            padding: 10px 0 7px 0;
        }

        .intro-table .intro-image {
            flex: 0 0 auto;
        }

        .intro-table .intro-divider {
            font-size: 40px;
            color: #222;
            font-weight: 100;
            line-height: 1;
            align-self: center;
            position: relative;
            top: -4px;
        }

        .intro-table .intro-name {
            flex: 0 0 auto;
            font-size: 18px;
            font-weight: 700;
            display: flex;
            flex-direction: column;
            gap: 2px;
            align-items: flex-start;
            text-align: left;
            color: #222;
        }

        .intro-table .intro-name-en {
            font-size: 18px;
            font-weight: 700;
        }

        .intro-table .intro-name-ko {
            font-size: 14px;
            font-weight: 400;
        }

        .intro-table .intro-members {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
            padding: 0 0 8px 0;
            color: #222;
            border-bottom: 2px solid rgba(0, 0, 0, 0.2);
            margin: 0 10px;
        }

        .intro-table .member-item {
            background: transparent;
            padding: 0;
            font-size: 14px;
            flex: 1;
            text-align: center;
        }

        .intro-table .intro-links {
            display: flex;
            justify-content: space-around;
            gap: 10px;
            padding: 10px 0 5px 0;
            color: #222;
        }

        .intro-table .intro-link-item {
            font-size: 13px;
            font-weight: 700;
        }

        .wiki-table {
            width: 100%;
            max-width: 700px;
            border-collapse: collapse;
            margin: 20px auto;
            border: 2px solid var(--namu-green);
        }

        .wiki-table th {
            background: var(--table-header-bg);
            color: white;
            padding: 5px 10px;
            font-weight: 500;
            border: 1px solid var(--border-color);
        }

        .wiki-table td {
            padding: 5px 10px;
            border: 1px solid var(--border-color);
            background: white;
        }

        .wiki-table td img {
            display: block;
            margin: 0 auto;
            max-width: 100%;
            height: auto;
        }

        .wiki-image {
            max-width: 100%;
            height: auto;
            margin: 20px auto;
            display: block;
            border-radius: 4px;
            border: 1px solid var(--border-color);
        }

        .action-buttons {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .fab-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            background: var(--namu-green);
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transition: all 0.3s;
        }

        .fab-btn:hover {
            background: var(--namu-dark-green);
            transform: scale(1.1);
        }

        .section-number {
            color: var(--namu-green);
            margin-right: 8px;
        }

        .wiki-category {
            background: var(--namu-light-green);
            padding: 8px 12px;
            border-radius: 4px;
            margin-bottom: 10px;
            font-size: 14px;
            color: #666;
            border: 1px solid var(--border-color);
        }

        .wiki-meta {
            display: flex;
            gap: 15px;
            font-size: 13px;
            color: #666;
            margin-bottom: 10px;
        }

        .wiki-meta-item {
            cursor: pointer;
        }

        .wiki-meta-item:hover {
            color: var(--namu-green);
        }

        .collapse-icon {
            display: inline;
        }

        .collapse-icon:before {
            color: #666;
            content: "\f3d0";
            float: left;
            font-family: "Ionicons";
            font-size: .8em;
            font-weight: 400;
            line-height: 1.8em;
            margin: 0 .5rem 0 .2rem;
            text-align: center;
            width: .9em;
        }

        .sortable-sections {
            min-height: 50px;
        }

        .drag-handle {
            cursor: move;
            color: #999;
            margin-right: 10px;
        }

        .text-toolbar {
            display: flex;
            gap: 5px;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }

        .text-toolbar button {
            padding: 5px 10px;
            border: 1px solid var(--border-color);
            background: white;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }

        .text-toolbar button:hover {
            background: var(--namu-light-green);
        }

        .table-cell-wrapper {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .merge-controls {
            position: absolute;
            top: 2px;
            right: 2px;
            display: flex;
            gap: 2px;
            z-index: 10;
        }

        .merge-btn {
            width: 20px;
            height: 20px;
            border: 1px solid #ccc;
            background: white;
            border-radius: 3px;
            cursor: pointer;
            font-size: 10px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .merge-btn:hover {
            background: var(--namu-light-green);
        }

        .merge-btn.active {
            background: var(--namu-green);
            color: white;
            border-color: var(--namu-green);
        }

        .profile-row-item {
            background: white;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .profile-row-item input {
            flex: 1;
            min-width: 0;
            max-width: 100%;
        }

        .profile-row-item .btn {
            padding: 5px 10px;
            font-size: 12px;
            flex-shrink: 0;
        }
    </style>
</head>
<body>
    <!-- ÏôºÏ™Ω Ìé∏Ïßë Ìå®ÎÑê -->
    <div class="editor-panel">
        <h2>üìù ÏúÑÌÇ§ ÏóêÎîîÌÑ∞</h2>
        
        <!-- Í∏∞Î≥∏ ÌîÑÎ°úÌïÑ Ï†ïÎ≥¥ -->
        <div class="form-group">
            <label>Ï†úÎ™©</label>
            <input type="text" id="pageTitle" placeholder="ÌéòÏù¥ÏßÄ Ï†úÎ™©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" value="RIIZE">
        </div>

        <div class="form-group">
            <label>Î∂ÑÎ•ò (ÏâºÌëúÎ°ú Íµ¨Î∂Ñ)</label>
            <input type="text" id="categories" placeholder="Ïòà: K-POP, ÏïÑÏù¥Îèå, SM Entertainment" value="K-POP, Î≥¥Ïù¥Í∑∏Î£π, SM">
        </div>

        <div class="form-group">
            <label>ÏÜåÍ∞ú Ìëú - Î°úÍ≥† Ïù¥ÎØ∏ÏßÄ</label>
            <input type="file" id="introImageFile" accept="image/*">
            <input type="text" id="introImageUrl" placeholder="ÎòêÎäî Ïù¥ÎØ∏ÏßÄ URL" style="margin-top: 5px;">
        </div>

        <div class="form-group">
            <label>Ìó§Îçî Í∏ÄÏî®ÏÉâ (ÏÜåÍ∞úÌëú/ÌîÑÎ°úÌïÑ/Î≥∏Î¨∏Ìëú)</label>
            <select id="headerTextColor">
                <option value="#222">Í≤ÄÏ†ï</option>
                <option value="#fff">Ìù∞ÏÉâ</option>
            </select>
        </div>

        <div class="form-group">
            <label>ÏÜåÍ∞ú Ìëú - Í∑∏Î£πÎ™Ö (ÏòÅÏñ¥)</label>
            <input type="text" id="introGroupNameEn" placeholder="ÏòÅÏñ¥ Í∑∏Î£πÎ™Ö" value="RIIZE">
        </div>

        <div class="form-group">
            <label>ÏÜåÍ∞ú Ìëú - Í∑∏Î£πÎ™Ö (ÌïúÍ∏Ä)</label>
            <input type="text" id="introGroupNameKo" placeholder="ÌïúÍ∏Ä Í∑∏Î£πÎ™Ö" value="ÎùºÏù¥Ï¶à">
        </div>

        <div class="form-group">
            <label>ÏÜåÍ∞ú Ìëú - Î©§Î≤Ñ (ÏâºÌëúÎ°ú Íµ¨Î∂Ñ)</label>
            <input type="text" id="introMembers" placeholder="Ïòà: ÏáºÌÉÄÎ°ú, ÏùÄÏÑù, ÏÑ±Ï∞¨..." value="ÏáºÌÉÄÎ°ú, ÏùÄÏÑù, ÏÑ±Ï∞¨, ÏõêÎπà, ÏäπÌïú, Ïï§ÌÜ§">
        </div>

        <div class="form-group">
            <label>ÏµúÍ∑º ÏàòÏ†ï ÏãúÍ∞Å</label>
            <input type="text" id="lastModified" placeholder="ÏµúÍ∑º ÏàòÏ†ï ÏãúÍ∞Å" value="2025-12-06 15:30:25">
        </div>

        <div class="form-group">
            <label>ÌîÑÎ°úÌïÑ Ïù¥ÎØ∏ÏßÄ</label>
            <div class="image-upload-group">
                <input type="file" id="profileImage" accept="image/*">
                <input type="text" id="profileImageUrl" placeholder="ÎòêÎäî Ïù¥ÎØ∏ÏßÄ URL ÏûÖÎ†•">
                <img id="profileImagePreview" class="image-preview">
            </div>
        </div>

        <div class="form-group">
            <button class="btn btn-primary" onclick="addProfileRow()" style="width: 100%;">‚ûï ÌîÑÎ°úÌïÑ Ìï≠Î™© Ï∂îÍ∞Ä</button>
        </div>

        <div id="profile-rows-list">
            <!-- ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎêòÎäî ÌîÑÎ°úÌïÑ ÌñâÎì§ -->
        </div>

        <h2 style="margin-top: 30px;">‚ûï ÏÑπÏÖò Ï∂îÍ∞Ä</h2>
        <div class="button-group">
            <button class="btn btn-primary" onclick="addSection('heading')">üìå Ï†úÎ™©</button>
            <button class="btn btn-primary" onclick="addSection('text')">üìÑ ÌÖçÏä§Ìä∏</button>
            <button class="btn btn-primary" onclick="addSection('collapse')">üìã Ï∂ïÏïΩ</button>
            <button class="btn btn-primary" onclick="addSection('table')">üìä Ìëú</button>
            <button class="btn btn-primary" onclick="addSection('image')">üñºÔ∏è Ïù¥ÎØ∏ÏßÄ</button>
        </div>

        <!-- Ï∂îÍ∞ÄÎêú ÏÑπÏÖò Î™©Î°ù -->
        <div id="sections-list" class="sortable-sections"></div>

        <!-- ÌÖåÎßà ÏÑ§Ï†ï -->
        <div class="color-theme">
            <h2>üé® ÌÖåÎßà ÏÑ§Ï†ï</h2>
            <div class="form-group">
                <label>Î©îÏù∏ Ïª¨Îü¨</label>
                <div class="color-input-group">
                    <input type="color" id="themeColor" value="#2db400">
                    <input type="text" id="themeColorText" value="#2db400">
                </div>
            </div>
        </div>
    </div>

    <!-- Ïò§Î•∏Ï™Ω ÌîÑÎ¶¨Î∑∞ Ìå®ÎÑê -->
    <div class="preview-panel">
        <div id="wiki-preview">
            <!-- 1. ÎåÄÏ†úÎ™© -->
            <div class="wiki-header">
                <h1 class="wiki-title">RIIZE</h1>
            </div>

            <!-- 2. ÏµúÍ∑º ÏàòÏ†ï -->
            <div class="wiki-meta">
                <span id="lastModifiedPreview">ÏµúÍ∑º ÏàòÏ†ï: 2025-12-06 15:30:25</span>
            </div>

            <!-- 3. Î∂ÑÎ•ò -->
            <div id="wikiCategories" class="wiki-category" style="background: white !important; border-radius: 4px !important; padding: 8px 12px !important; border: 1px solid #ddd !important;">
                <span style="color: #222; font-weight: normal;">Î∂ÑÎ•ò:</span>
                <span class="wiki-category-item">K-POP</span> | 
                <span class="wiki-category-item">Î≥¥Ïù¥Í∑∏Î£π</span> | 
                <span class="wiki-category-item">SM</span>
            </div>

            <!-- 4. ÌäπÏàò Ìëú (ÏïÑÏù¥Îèå ÏÜåÍ∞úÏö©) -->
            <table class="intro-table">
                <tr>
                    <td>
                        <div class="intro-first-row">
                            <div class="intro-row1">
                                <div class="intro-image" id="introImagePreview">Î°úÍ≥†</div>
                                <div class="intro-divider">|</div>
                                <div class="intro-name">
                                    <div class="intro-name-en" id="introGroupNameEnPreview">RIIZE</div>
                                    <div class="intro-name-ko" id="introGroupNameKoPreview">ÎùºÏù¥Ï¶à</div>
                                </div>
                            </div>
                        </div>
                        <div class="intro-members" id="introMembersPreview">
                            <div class="member-item">ÏáºÌÉÄÎ°ú</div>
                            <div class="member-item">ÏùÄÏÑù</div>
                            <div class="member-item">ÏÑ±Ï∞¨</div>
                            <div class="member-item">ÏõêÎπà</div>
                            <div class="member-item">ÏäπÌïú</div>
                            <div class="member-item">Ïï§ÌÜ§</div>
                        </div>
                        <div class="intro-links">
                            <span class="intro-link-item">[ ÌïúÍµ≠ ÏùåÎ∞ò ]</span>
                            <span class="intro-link-item">[ Ï∞∏Ïó¨ ÏùåÎ∞ò ]</span>
                            <span class="intro-link-item">[ Í¥ÄÎ†® Î¨∏ÏÑú ]</span>
                        </div>
                    </td>
                </tr>
            </table>

            <!-- 5. Î™©Ï∞® + ÌîÑÎ°úÌïÑ (ÏÑ∏Ìä∏) -->
            <div class="wiki-content">
                <div class="wiki-main">
                    <div class="wiki-toc">
                        <div class="wiki-toc-title">Î™©Ï∞®</div>
                        <ul class="wiki-toc-list" id="tocList">
                            <!-- ÏûêÎèô ÏÉùÏÑ±Îê® -->
                        </ul>
                    </div>
                </div>

                <aside class="profile-box">
                    <div style="background: var(--namu-green); padding: 10px;">
                        <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                            <div id="profileIntroImagePreview" style="flex: 0 0 auto;">Î°úÍ≥†</div>
                            <div style="font-size: 40px; color: #222; font-weight: 100; line-height: 1; position: relative; top: -4px;">|</div>
                            <div style="flex: 0 0 auto; font-size: 18px; font-weight: 700; display: flex; flex-direction: column; gap: 2px; align-items: flex-start; text-align: left; color: #222;">
                                <div id="profileIntroNameEnPreview">RIIZE</div>
                                <div id="profileIntroNameKoPreview" style="font-size: 14px; font-weight: 400;">ÎùºÏù¥Ï¶à</div>
                            </div>
                        </div>
                    </div>
                    <div class="profile-image" id="previewProfileImage">
                        ÌîÑÎ°úÌïÑ Ïù¥ÎØ∏ÏßÄ
                    </div>
                    <table class="profile-table" id="previewProfileTable">
                        <!-- ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê® -->
                    </table>
                </aside>
            </div>

            <!-- 6. Î≥∏Î¨∏ (Î™©Ï∞®+ÌîÑÎ°úÌïÑ ÏÑ∏Ìä∏ ÏïÑÎûò) -->
            <div class="wiki-full-content">
                <div id="dynamicContent">
                    <!-- ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎêòÎäî ÏΩòÌÖêÏ∏† -->
                </div>
            </div>
        </div>
    </div>

    <!-- ÌïòÎã® Ïï°ÏÖò Î≤ÑÌäº -->
    <div class="action-buttons">
        <button class="fab-btn" onclick="captureWiki()" title="Ï∫°Ï≤ò">üì∏</button>
        <button class="fab-btn" onclick="saveWiki()" title="Ï†ÄÏû•">üíæ</button>
        <button class="fab-btn" onclick="loadWiki()" title="Î∂àÎü¨Ïò§Í∏∞">üìÇ</button>
    </div>

    <script>
        let sections = [];
        let sectionCounter = 0;
        let profileRows = [];
        let profileRowCounter = 0;

        // Ï¥àÍ∏∞ ÌîÑÎ°úÌïÑ Ìñâ Ï∂îÍ∞Ä
        function initializeProfile() {
            addProfileRow('Ïù¥Î¶Ñ', 'RIIZE');
            addProfileRow('ÏÜåÏÜç', 'SM Entertainment');
            addProfileRow('Îç∞Î∑î', '2023ÎÖÑ 9Ïõî 4Ïùº');
            addProfileRow('Î©§Î≤Ñ', '6Î™Ö');
            addProfileRow('Ïû•Î•¥', 'K-POP, R&B, Dance');
        }

        // ÌîÑÎ°úÌïÑ Ìñâ Ï∂îÍ∞Ä
        function addProfileRow(header = '', value = '') {
            profileRowCounter++;
            const row = {
                id: profileRowCounter,
                header: header,
                value: value
            };
            profileRows.push(row);
            renderProfileRowEditor(row);
            updateProfilePreview();
        }

        function renderProfileRowEditor(row) {
            const container = document.getElementById('profile-rows-list');
            const rowDiv = document.createElement('div');
            rowDiv.className = 'profile-row-item';
            rowDiv.id = `profile-row-${row.id}`;
            
            rowDiv.innerHTML = `
                <input type="text" placeholder="Ìï≠Î™©Î™Ö" value="${row.header}" 
                       onkeyup="updateProfileRow(${row.id}, 'header', this.value)">
                <input type="text" placeholder="ÎÇ¥Ïö©" value="${row.value}" 
                       onkeyup="updateProfileRow(${row.id}, 'value', this.value)">
                <button class="btn btn-danger" onclick="removeProfileRow(${row.id})">√ó</button>
            `;
            
            container.appendChild(rowDiv);
        }

        function updateProfileRow(rowId, field, value) {
            const row = profileRows.find(r => r.id === rowId);
            if (row) {
                row[field] = value;
                updateProfilePreview();
            }
        }

        function removeProfileRow(rowId) {
            profileRows = profileRows.filter(r => r.id !== rowId);
            document.getElementById(`profile-row-${rowId}`).remove();
            updateProfilePreview();
        }

        function updateProfilePreview() {
            const table = document.getElementById('previewProfileTable');
            let html = '';
            
            profileRows.forEach(row => {
                if (row.header || row.value) {
                    html += `
                        <tr>
                            <th>${row.header}</th>
                            <td>${row.value}</td>
                        </tr>
                    `;
                }
            });
            
            table.innerHTML = html;
        }

        // Î∂ÑÎ•ò Î∞è Î©îÌÉÄ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
        document.getElementById('categories').addEventListener('input', function() {
            const cats = this.value.split(',').map(c => c.trim()).filter(c => c);
            let html = '<span style="color: #222; font-weight: normal;">Î∂ÑÎ•ò:</span> ';
            html += cats.map(cat => `<span class="wiki-category-item">${cat}</span>`).join(' | ');
            document.getElementById('wikiCategories').innerHTML = html;
        });

        document.getElementById('lastModified').addEventListener('input', function() {
            document.getElementById('lastModifiedPreview').textContent = `ÏµúÍ∑º ÏàòÏ†ï: ${this.value}`;
        });

        // Ìó§Îçî Í∏ÄÏî®ÏÉâ Î≥ÄÍ≤Ω (ÏÜåÍ∞úÌëú + ÌîÑÎ°úÌïÑ + Î≥∏Î¨∏Ìëú)
        document.getElementById('headerTextColor').addEventListener('change', function() {
            const color = this.value;
            
            // ÏÜåÍ∞úÌëú Ï†ÑÏ≤¥
            document.getElementById('introGroupNameEnPreview').style.color = color;
            document.getElementById('introGroupNameKoPreview').style.color = color;
            document.querySelectorAll('.intro-table .member-item').forEach(el => el.style.color = color);
            document.querySelectorAll('.intro-table .intro-link-item').forEach(el => el.style.color = color);
            document.querySelector('.intro-table .intro-divider').style.color = color;
            
            // ÏÜåÍ∞úÌëú Í∞ÄÎ°úÏÑ†
            const borderColor = color === '#fff' ? 'rgba(255, 255, 255, 0.3)' : 'rgba(0, 0, 0, 0.2)';
            document.querySelector('.intro-table .intro-members').style.borderBottomColor = borderColor;
            
            // ÌîÑÎ°úÌïÑ Ìó§Îçî
            document.querySelectorAll('.profile-table th').forEach(el => el.style.color = color);
            
            // Î≥∏Î¨∏ Ìëú Ìó§Îçî
            document.querySelectorAll('.wiki-table th').forEach(el => el.style.color = color);
        });

        // ÌäπÏàò Ìëú - Î°úÍ≥† Ïù¥ÎØ∏ÏßÄ
        document.getElementById('introImageFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const imgHTML = `<img src="${event.target.result}" style="max-height: 60px; border-radius: 6px;">`;
                    document.getElementById('introImagePreview').innerHTML = imgHTML;
                    document.getElementById('profileIntroImagePreview').innerHTML = imgHTML;
                };
                reader.readAsDataURL(file);
            }
        });

        document.getElementById('introImageUrl').addEventListener('input', function() {
            if (this.value) {
                const imgHTML = `<img src="${this.value}" style="max-height: 60px; border-radius: 6px;">`;
                document.getElementById('introImagePreview').innerHTML = imgHTML;
                document.getElementById('profileIntroImagePreview').innerHTML = imgHTML;
            }
        });

        // ÌäπÏàò Ìëú - Í∑∏Î£πÎ™Ö
        document.getElementById('introGroupNameEn').addEventListener('input', function() {
            document.getElementById('introGroupNameEnPreview').textContent = this.value;
            document.getElementById('profileIntroNameEnPreview').textContent = this.value;
        });

        document.getElementById('introGroupNameKo').addEventListener('input', function() {
            document.getElementById('introGroupNameKoPreview').textContent = this.value;
            document.getElementById('profileIntroNameKoPreview').textContent = this.value;
        });

        // ÌäπÏàò Ìëú - Î©§Î≤Ñ
        document.getElementById('introMembers').addEventListener('input', function() {
            const members = this.value.split(',').map(m => m.trim()).filter(m => m);
            const html = members.map(m => `<div class="member-item">${m}</div>`).join('');
            document.getElementById('introMembersPreview').innerHTML = html;
        });

        // Ïã§ÏãúÍ∞Ñ ÌîÑÎ¶¨Î∑∞ ÏóÖÎç∞Ïù¥Ìä∏
        document.getElementById('pageTitle').addEventListener('input', function() {
            const title = this.value;
            document.querySelector('.wiki-title').textContent = title;
            
            // ÏûêÎèôÏúºÎ°ú ÏÜåÍ∞úÌëú ÏòÅÏñ¥Î™Ö ÎèôÍ∏∞Ìôî
            document.getElementById('introGroupNameEn').value = title;
            document.getElementById('introGroupNameEnPreview').textContent = title;
            
            // ÌîÑÎ°úÌïÑ Ïù¥Î¶Ñ Ìñâ ÏûêÎèô ÎèôÍ∏∞Ìôî
            const nameRow = profileRows.find(row => row.header === 'Ïù¥Î¶Ñ');
            if (nameRow) {
                nameRow.value = title;
                const input = document.getElementById(`profile-value-${nameRow.id}`);
                if (input) {
                    input.value = title;
                }
                updateProfilePreview();
            }
        });

        // ÌîÑÎ°úÌïÑ Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú
        document.getElementById('profileImage').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = document.getElementById('profileImagePreview');
                    img.src = event.target.result;
                    img.classList.add('show');
                    
                    document.getElementById('previewProfileImage').innerHTML = 
                        `<img src="${event.target.result}" alt="ÌîÑÎ°úÌïÑ">`;
                };
                reader.readAsDataURL(file);
            }
        });

        document.getElementById('profileImageUrl').addEventListener('input', function() {
            if (this.value) {
                const img = document.getElementById('profileImagePreview');
                img.src = this.value;
                img.classList.add('show');
                
                document.getElementById('previewProfileImage').innerHTML = 
                    `<img src="${this.value}" alt="ÌîÑÎ°úÌïÑ">`;
            }
        });

        // ÌÖåÎßà Ïª¨Îü¨ Î≥ÄÍ≤Ω
        document.getElementById('themeColor').addEventListener('input', function() {
            document.getElementById('themeColorText').value = this.value;
            applyTheme(this.value);
        });

        document.getElementById('themeColorText').addEventListener('input', function() {
            document.getElementById('themeColor').value = this.value;
            applyTheme(this.value);
        });

        function applyTheme(color) {
            document.documentElement.style.setProperty('--namu-green', color);
            document.documentElement.style.setProperty('--table-header-bg', color);
            
            const lightColor = adjustColor(color, 40);
            document.documentElement.style.setProperty('--namu-light-green', lightColor);
        }

        function adjustColor(color, percent) {
            const num = parseInt(color.replace("#",""), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) + amt;
            const G = (num >> 8 & 0x00FF) + amt;
            const B = (num & 0x0000FF) + amt;
            return "#" + (0x1000000 + (R<255?R<1?0:R:255)*0x10000 +
                (G<255?G<1?0:G:255)*0x100 + (B<255?B<1?0:B:255))
                .toString(16).slice(1);
        }

        // ÏÑπÏÖò Ï∂îÍ∞Ä
        function addSection(type) {
            sectionCounter++;
            const section = {
                id: sectionCounter,
                type: type,
                level: 1,
                title: '',
                content: '',
                collapseLink: '', // Ï∂ïÏïΩÏö©
                imageFile: null,
                imageUrl: '',
                imageWidth: '', // Ïù¥ÎØ∏ÏßÄ ÎÑàÎπÑ
                tableData: { 
                    cols: 2,
                    rows: 2,
                    width: 700,
                    data: [['', ''], ['', '']],
                    cellStyles: {}, // { "row-col": { isHeader: true/false } }
                    mergeInfo: [] // { row, col, colspan, rowspan }
                }
            };
            sections.push(section);
            renderSectionEditor(section);
            updatePreview();
        }

        function renderSectionEditor(section) {
            const sectionsList = document.getElementById('sections-list');
            const sectionDiv = document.createElement('div');
            sectionDiv.className = 'section-item';
            sectionDiv.id = `section-${section.id}`;

            let editorHTML = `
                <div class="section-header">
                    <span class="drag-handle">‚ò∞</span>
                    <span class="section-type">${getSectionTypeLabel(section.type)}</span>
                    <button class="btn btn-danger" onclick="removeSection(${section.id})" style="padding: 5px 10px; font-size: 12px;">ÏÇ≠Ï†ú</button>
                </div>
            `;

            switch(section.type) {
                case 'heading':
                    editorHTML += `
                        <div class="form-group">
                            <label>Î†àÎ≤®</label>
                            <select id="level-${section.id}" onchange="updateSectionData(${section.id}, 'level', this.value)">
                                <option value="1">H1 (##)</option>
                                <option value="2">H2 (###)</option>
                                <option value="3">H3 (####)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Ï†úÎ™©</label>
                            <input type="text" id="title-${section.id}" 
                                   placeholder="Ï†úÎ™©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" 
                                   onkeyup="updateSectionData(${section.id}, 'title', this.value)">
                        </div>
                    `;
                    break;
                case 'text':
                    editorHTML += `
                        <div class="form-group">
                            <label>ÎÇ¥Ïö©</label>
                            <div class="text-toolbar">
                                <button onclick="insertTextFormat(${section.id}, 'bold')"><b>B</b></button>
                                <button onclick="insertTextFormat(${section.id}, 'maincolor')">üé® ÎåÄÌëúÏÉâ</button>
                                <button onclick="insertTextFormat(${section.id}, 'quote')">‚ùù Ïù∏Ïö©</button>
                            </div>
                            <textarea id="content-${section.id}" 
                                      placeholder="ÌÖçÏä§Ìä∏ ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî&#10;&#10;ÏÑúÏãù:&#10;*ÍµµÍ≤å* = ÍµµÍ≤å&#10;[ÎåÄÌëúÏÉâ] = ÎåÄÌëúÏÉâ&#10;> Ïù∏Ïö©Î¨∏ = Ïù∏Ïö©" 
                                      onkeyup="updateSectionData(${section.id}, 'content', this.value)"
                                      style="min-height: 120px;"></textarea>
                        </div>
                    `;
                    break;
                case 'collapse':
                    editorHTML += `
                        <div class="form-group">
                            <label>ÎßÅÌÅ¨ ÌÖçÏä§Ìä∏</label>
                            <input type="text" id="collapseLink-${section.id}" 
                                   placeholder="Ïòà: Ïù¥Í±∞ Ïª§Ïä§ÌÖÄ" 
                                   onkeyup="updateSectionData(${section.id}, 'collapseLink', this.value)">
                        </div>
                    `;
                    break;
                case 'image':
                    editorHTML += `
                        <div class="form-group">
                            <label>Ïù¥ÎØ∏ÏßÄ ÌååÏùº</label>
                            <input type="file" id="imageFile-${section.id}" accept="image/*" 
                                   onchange="handleImageUpload(${section.id}, this)">
                        </div>
                        <div class="form-group">
                            <label>ÎòêÎäî Ïù¥ÎØ∏ÏßÄ URL</label>
                            <input type="text" id="imageUrl-${section.id}" 
                                   placeholder="Ïù¥ÎØ∏ÏßÄ URLÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" 
                                   onkeyup="updateSectionData(${section.id}, 'imageUrl', this.value)">
                        </div>
                        <div class="form-group">
                            <label>Ïù¥ÎØ∏ÏßÄ Í∞ÄÎ°ú ÌÅ¨Í∏∞ (px)</label>
                            <input type="number" id="imageWidth-${section.id}" 
                                   placeholder="ÎπÑÏõåÎëêÎ©¥ ÏûêÎèô" 
                                   onkeyup="updateSectionData(${section.id}, 'imageWidth', this.value)"
                                   style="width: 150px;">
                        </div>
                        <img id="imagePreview-${section.id}" style="max-width: 100%; margin-top: 10px; display: none;">
                    `;
                    break;
                case 'table':
                    editorHTML += `
                        <div class="form-group">
                            <label>Ìëú ÌÅ¨Í∏∞</label>
                            <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                                <div>
                                    <label style="font-size: 12px;">Ïó¥:</label>
                                    <input type="number" id="tableCols-${section.id}" value="2" min="1" max="10" 
                                           style="width: 60px;" onchange="updateTableSize(${section.id})">
                                </div>
                                <div>
                                    <label style="font-size: 12px;">Ìñâ:</label>
                                    <input type="number" id="tableRows-${section.id}" value="2" min="1" max="20" 
                                           style="width: 60px;" onchange="updateTableSize(${section.id})">
                                </div>
                                <div>
                                    <label style="font-size: 12px;">ÎÑàÎπÑ(px):</label>
                                    <input type="number" id="tableWidth-${section.id}" value="700" min="100" max="1000" 
                                           style="width: 80px;" onchange="updateTableWidth(${section.id})">
                                </div>
                            </div>
                            <div id="table-editor-${section.id}"></div>
                        </div>
                    `;
                    break;
            }

            sectionDiv.innerHTML = editorHTML;
            sectionsList.appendChild(sectionDiv);

            if (section.type === 'table') {
                renderTableEditor(section);
            }
        }

        function getSectionTypeLabel(type) {
            const labels = {
                'heading': 'üìå Ï†úÎ™©',
                'text': 'üìÑ ÌÖçÏä§Ìä∏',
                'collapse': 'üìã Ï∂ïÏïΩ',
                'table': 'üìä Ìëú',
                'image': 'üñºÔ∏è Ïù¥ÎØ∏ÏßÄ'
            };
            return labels[type] || type;
        }

        function insertTextFormat(sectionId, format) {
            const textarea = document.getElementById(`content-${sectionId}`);
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const selectedText = textarea.value.substring(start, end);
            let replacement = '';

            switch(format) {
                case 'bold':
                    replacement = `*${selectedText || 'ÍµµÍ≤å'}*`;
                    break;
                case 'maincolor':
                    replacement = `[${selectedText || 'ÎåÄÌëúÏÉâ'}]`;
                    break;
                case 'quote':
                    replacement = `> ${selectedText || 'Ïù∏Ïö©Î¨∏'}`;
                    break;
            }

            if (replacement) {
                textarea.value = textarea.value.substring(0, start) + replacement + textarea.value.substring(end);
                textarea.setSelectionRange(start, start + replacement.length);
                updateSectionData(sectionId, 'content', textarea.value);
            }
        }

        function handleImageUpload(sectionId, input) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const section = sections.find(s => s.id === sectionId);
                    if (section) {
                        section.imageFile = e.target.result;
                        document.getElementById(`imagePreview-${sectionId}`).src = e.target.result;
                        document.getElementById(`imagePreview-${sectionId}`).style.display = 'block';
                        updatePreview();
                    }
                };
                reader.readAsDataURL(file);
            }
        }

        function updateSectionData(sectionId, field, value) {
            const section = sections.find(s => s.id === sectionId);
            if (section) {
                section[field] = value;
                updatePreview();
            }
        }

        function removeSection(sectionId) {
            sections = sections.filter(s => s.id !== sectionId);
            document.getElementById(`section-${sectionId}`).remove();
            updatePreview();
        }

        function updateTableSize(sectionId) {
            const section = sections.find(s => s.id === sectionId);
            if (!section) return;

            const newCols = parseInt(document.getElementById(`tableCols-${sectionId}`).value);
            const newRows = parseInt(document.getElementById(`tableRows-${sectionId}`).value);

            // Ìñâ Ï°∞Ï†ï
            while (section.tableData.data.length < newRows) {
                section.tableData.data.push(new Array(newCols).fill(''));
            }
            section.tableData.data = section.tableData.data.slice(0, newRows);

            // Í∞Å ÌñâÏùò Ïó¥ Ïàò Ï°∞Ï†ï
            section.tableData.data = section.tableData.data.map(row => {
                while (row.length < newCols) row.push('');
                return row.slice(0, newCols);
            });

            section.tableData.cols = newCols;
            section.tableData.rows = newRows;

            if (!section.tableData.cellStyles) {
                section.tableData.cellStyles = {};
            }

            renderTableEditor(section);
            updatePreview();
        }

        function updateTableWidth(sectionId) {
            const section = sections.find(s => s.id === sectionId);
            if (!section) return;

            const newWidth = parseInt(document.getElementById(`tableWidth-${sectionId}`).value);
            section.tableData.width = newWidth;
            updatePreview();
        }

        function renderTableEditor(section) {
            const container = document.getElementById(`table-editor-${section.id}`);
            
            if (!section.tableData.mergeInfo) {
                section.tableData.mergeInfo = [];
            }
            if (!section.tableData.cellStyles) {
                section.tableData.cellStyles = {};
            }
            
            let html = '<div style="margin: 15px 0;"><strong>Îç∞Ïù¥ÌÑ∞:</strong> <span style="font-size: 12px; color: #666;">(ÏÖÄ ÌÅ¥Î¶≠ÏúºÎ°ú ÏÑ†ÌÉù)</span></div>';
            
            html += `
                <div style="margin-bottom: 10px;">
                    <button class="btn btn-primary" onclick="mergeSelectedCells(${section.id})" style="font-size: 12px; padding: 5px 10px;">
                        Î≥ëÌï©ÌïòÍ∏∞
                    </button>
                    <button class="btn btn-secondary" onclick="toggleHeaderStyle(${section.id})" style="font-size: 12px; padding: 5px 10px;">
                        Ìó§ÎçîÎ°ú Î≥ÄÍ≤Ω
                    </button>
                    <button class="btn btn-secondary" onclick="clearSelection(${section.id})" style="font-size: 12px; padding: 5px 10px;">
                        ÏÑ†ÌÉù Ìï¥Ï†ú
                    </button>
                    <button class="btn btn-danger" onclick="unmergeCell(${section.id})" style="font-size: 12px; padding: 5px 10px;">
                        Î≥ëÌï© Ìï¥Ï†ú
                    </button>
                </div>
            `;
            
            html += '<div id="table-grid-' + section.id + '" style="display: grid; grid-template-columns: repeat(' + section.tableData.cols + ', 1fr); gap: 5px;">';
            
            section.tableData.data.forEach((row, rowIdx) => {
                row.forEach((cell, cellIdx) => {
                    const cellId = `cell-${section.id}-${rowIdx}-${cellIdx}`;
                    const cellKey = `${rowIdx}-${cellIdx}`;
                    const isImage = cell && cell.startsWith('<img');
                    const isHeader = section.tableData.cellStyles[cellKey]?.isHeader || false;
                    
                    // Ïù¥ÎØ∏ÏßÄ ÌÅ¨Í∏∞ Í∞ÄÏ†∏Ïò§Í∏∞
                    let imageWidth = '';
                    if (isImage && section.tableData.cellStyles[cellKey]?.imageWidth) {
                        imageWidth = section.tableData.cellStyles[cellKey].imageWidth;
                    }
                    
                    html += `
                        <div class="table-cell-wrapper" id="${cellId}-wrapper" 
                             onclick="toggleCellSelection(${section.id}, ${rowIdx}, ${cellIdx})"
                             style="cursor: pointer; border: 2px solid transparent; padding: 3px; border-radius: 4px; background: ${isHeader ? '#e8f5e9' : 'white'};">
                            ${isImage ? `
                                <div style="display: flex; align-items: center; gap: 5px; font-size: 11px; color: #666; margin-bottom: 2px;">
                                    <span>üñºÔ∏è Ïù¥ÎØ∏ÏßÄ ÏûàÏùå</span>
                                    <input type="number" 
                                           id="imgWidth-${section.id}-${rowIdx}-${cellIdx}"
                                           value="${imageWidth}" 
                                           placeholder="Í∞ÄÎ°ú(px)" 
                                           onclick="event.stopPropagation()"
                                           onchange="updateImageWidth(${section.id}, ${rowIdx}, ${cellIdx}, this.value)"
                                           style="width: 70px; padding: 2px 4px; font-size: 10px;">
                                </div>
                            ` : ''}
                            <input type="text" value="${isImage ? '' : cell}" 
                                   placeholder="ÏÖÄ ${rowIdx + 1}-${cellIdx + 1}"
                                   onclick="event.stopPropagation()"
                                   onkeyup="updateTableCell(${section.id}, ${rowIdx}, ${cellIdx}, this.value)"
                                   style="background: transparent;">
                            <button onclick="event.stopPropagation(); addImageToTableCell(${section.id}, ${rowIdx}, ${cellIdx})" 
                                    style="position: absolute; right: 8px; top: ${isImage ? '40px' : '11px'}; font-size: 11px; padding: 2px 6px; border: 1px solid #ddd; background: white; cursor: pointer;">
                                üñºÔ∏è
                            </button>
                        </div>
                    `;
                });
            });
            html += '</div>';

            container.innerHTML = html;
        }

        // Ìó§Îçî Ïä§ÌÉÄÏùº ÌÜ†Í∏Ä
        function toggleHeaderStyle(sectionId) {
            const cellSet = selectedCells.get(sectionId);
            if (!cellSet || cellSet.size === 0) {
                alert('Ïä§ÌÉÄÏùºÏùÑ Î≥ÄÍ≤ΩÌï† ÏÖÄÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            const section = sections.find(s => s.id === sectionId);
            if (!section) return;

            cellSet.forEach(cellKey => {
                if (!section.tableData.cellStyles[cellKey]) {
                    section.tableData.cellStyles[cellKey] = {};
                }
                section.tableData.cellStyles[cellKey].isHeader = !section.tableData.cellStyles[cellKey].isHeader;
            });

            clearSelection(sectionId);
            renderTableEditor(section);
            updatePreview();
        }

        // ÏÖÄ ÏÑ†ÌÉù ÌÜ†Í∏Ä
        const selectedCells = new Map(); // sectionId -> Set of "row-col"

        function toggleCellSelection(sectionId, row, col) {
            if (!selectedCells.has(sectionId)) {
                selectedCells.set(sectionId, new Set());
            }
            
            const cellSet = selectedCells.get(sectionId);
            const cellKey = `${row}-${col}`;
            const wrapper = document.getElementById(`cell-${sectionId}-${row}-${col}-wrapper`);
            
            if (cellSet.has(cellKey)) {
                cellSet.delete(cellKey);
                wrapper.style.border = '2px solid transparent';
            } else {
                cellSet.add(cellKey);
                wrapper.style.border = '2px solid var(--namu-green)';
            }
        }

        function clearSelection(sectionId) {
            const cellSet = selectedCells.get(sectionId);
            if (cellSet) {
                cellSet.forEach(cellKey => {
                    const [row, col] = cellKey.split('-').map(Number);
                    const wrapper = document.getElementById(`cell-${sectionId}-${row}-${col}-wrapper`);
                    if (wrapper) {
                        wrapper.style.border = '2px solid transparent';
                    }
                });
                cellSet.clear();
            }
        }

        function mergeSelectedCells(sectionId) {
            const cellSet = selectedCells.get(sectionId);
            if (!cellSet || cellSet.size < 2) {
                alert('ÏµúÏÜå 2Í∞úÏùò ÏÖÄÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            const cells = Array.from(cellSet).map(key => {
                const [row, col] = key.split('-').map(Number);
                return { row, col };
            });

            // ÏßÅÏÇ¨Í∞ÅÌòï ÏòÅÏó≠Ïù∏ÏßÄ ÌôïÏù∏
            const rows = cells.map(c => c.row);
            const cols = cells.map(c => c.col);
            const minRow = Math.min(...rows);
            const maxRow = Math.max(...rows);
            const minCol = Math.min(...cols);
            const maxCol = Math.max(...cols);

            const expectedCells = (maxRow - minRow + 1) * (maxCol - minCol + 1);
            if (cells.length !== expectedCells) {
                alert('ÏßÅÏÇ¨Í∞ÅÌòï ÏòÅÏó≠Îßå Î≥ëÌï©Ìï† Ïàò ÏûàÏäµÎãàÎã§.');
                return;
            }

            const section = sections.find(s => s.id === sectionId);
            if (!section) return;

            // Î≥ëÌï© Ï†ïÎ≥¥ Ï†ÄÏû•
            const mergeInfo = {
                row: minRow,
                col: minCol,
                rowspan: maxRow - minRow + 1,
                colspan: maxCol - minCol + 1
            };

            // Í∏∞Ï°¥ Î≥ëÌï© Ï†ïÎ≥¥ Ï§ë Í≤πÏπòÎäî Í≤É Ï†úÍ±∞
            section.tableData.mergeInfo = section.tableData.mergeInfo.filter(m => {
                return !(m.row >= minRow && m.row <= maxRow && m.col >= minCol && m.col <= maxCol);
            });

            section.tableData.mergeInfo.push(mergeInfo);
            
            clearSelection(sectionId);
            renderTableEditor(section);
            updatePreview();
            alert('Î≥ëÌï©ÎêòÏóàÏäµÎãàÎã§!');
        }

        function unmergeCell(sectionId) {
            const cellSet = selectedCells.get(sectionId);
            if (!cellSet || cellSet.size !== 1) {
                alert('Î≥ëÌï©ÏùÑ Ìï¥Ï†úÌï† ÏÖÄ 1Í∞úÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            const cellKey = Array.from(cellSet)[0];
            const [row, col] = cellKey.split('-').map(Number);
            
            const section = sections.find(s => s.id === sectionId);
            if (!section) return;

            // Ìï¥Îãπ ÏÖÄÏù¥ ÏÜçÌïú Î≥ëÌï© Ï†ïÎ≥¥ Ï∞æÍ∏∞
            const mergeIndex = section.tableData.mergeInfo.findIndex(m => 
                row >= m.row && row < m.row + m.rowspan &&
                col >= m.col && col < m.col + m.colspan
            );

            if (mergeIndex === -1) {
                alert('Î≥ëÌï©Îêú ÏÖÄÏù¥ ÏïÑÎãôÎãàÎã§.');
                return;
            }

            section.tableData.mergeInfo.splice(mergeIndex, 1);
            
            clearSelection(sectionId);
            renderTableEditor(section);
            updatePreview();
            alert('Î≥ëÌï©Ïù¥ Ìï¥Ï†úÎêòÏóàÏäµÎãàÎã§!');
        }

        function updateImageWidth(sectionId, row, col, width) {
            const section = sections.find(s => s.id === sectionId);
            if (!section) return;

            const cellKey = `${row}-${col}`;
            if (!section.tableData.cellStyles[cellKey]) {
                section.tableData.cellStyles[cellKey] = {};
            }
            section.tableData.cellStyles[cellKey].imageWidth = width;
            
            updatePreview();
        }

        function addImageToTableCell(sectionId, rowIdx, cellIdx) {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        const section = sections.find(s => s.id === sectionId);
                        if (section) {
                            section.tableData.data[rowIdx][cellIdx] = `<img src="${event.target.result}" style="max-width: 150px; max-height: 150px;">`;
                            renderTableEditor(section);
                            updatePreview();
                        }
                    };
                    reader.readAsDataURL(file);
                }
            };
            
            input.click();
        }

        function updateTableHeader(sectionId, idx, value) {
            const section = sections.find(s => s.id === sectionId);
            if (section) {
                section.tableData.headers[idx] = value;
                updatePreview();
            }
        }

        function updateTableCell(sectionId, rowIdx, cellIdx, value) {
            const section = sections.find(s => s.id === sectionId);
            if (section) {
                // Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏïÑÎãå Í≤ΩÏö∞ÏóêÎßå ÏóÖÎç∞Ïù¥Ìä∏
                if (!section.tableData.data[rowIdx][cellIdx].startsWith('<img')) {
                    section.tableData.data[rowIdx][cellIdx] = value;
                    updatePreview();
                }
            }
        }

        // ÌÖçÏä§Ìä∏ ÏÑúÏãù Ï≤òÎ¶¨
        function parseTextFormat(text) {
            if (!text) return '';
            
            // ÍµµÍ≤å - *ÌÖçÏä§Ìä∏*
            text = text.replace(/\*(.*?)\*/g, '<strong>$1</strong>');
            
            // ÎåÄÌëúÏª¨Îü¨ - [ÌÖçÏä§Ìä∏]
            text = text.replace(/\[(.*?)\]/g, '<span style="color: var(--namu-green);">$1</span>');
            
            // Ïù∏Ïö© - Ïù∏ÎùºÏù∏ÏúºÎ°ú
            text = text.replace(/^>\s*(.+)$/gm, '<span style="border-left: 3px solid var(--namu-green); padding-left: 15px; color: #666; font-style: italic; display: inline-block; margin: 0 5px;">$1</span>');
            
            // Ï§ÑÎ∞îÍøà
            text = text.replace(/\n/g, '<br>');
            
            return text;
        }

        // ÌîÑÎ¶¨Î∑∞ ÏóÖÎç∞Ïù¥Ìä∏
        function updatePreview() {
            const container = document.getElementById('dynamicContent');
            container.innerHTML = '';

            let headingCounters = [0, 0, 0, 0];
            let tocHTML = '';

            sections.forEach(section => {
                let sectionHTML = '';
                
                switch(section.type) {
                    case 'heading':
                        if (section.title) {
                            const level = parseInt(section.level);
                            headingCounters[level]++;
                            
                            for (let i = level + 1; i < headingCounters.length; i++) {
                                headingCounters[i] = 0;
                            }

                            let number = '';
                            for (let i = 1; i <= level; i++) {
                                number += (number ? '.' : '') + headingCounters[i];
                            }

                            const headingClass = level === 1 ? 'wiki-heading' : 
                                                 level === 2 ? 'wiki-heading wiki-heading-2' : 
                                                 'wiki-heading wiki-heading-3';
                            
                            const headingId = `section-${number.replace(/\./g, '-')}`;
                            
                            sectionHTML = `
                                <div class="wiki-section">
                                    <h${level + 1} class="${headingClass}" id="${headingId}">
                                        <span class="collapse-icon"></span>
                                        <span class="section-number">${number}.</span>${section.title}
                                    </h${level + 1}>
                                </div>
                            `;

                            const tocClass = `toc-level-${level}`;
                            tocHTML += `<li class="${tocClass}"><span class="toc-number">${number}.</span>${section.title}</li>`;
                        }
                        break;
                    case 'text':
                        if (section.content) {
                            sectionHTML = `<div class="wiki-text">${parseTextFormat(section.content)}</div>`;
                        }
                        break;
                    case 'collapse':
                        const linkText = section.collapseLink || 'Ïù¥Í±∞ Ïª§Ïä§ÌÖÄ';
                        sectionHTML = `
                            <div class="wiki-collapse" style="padding: 12px 0; margin: 15px 0; display: flex; align-items: center; gap: 10px;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" style="flex-shrink: 0; fill: #666;">
                                    <path d="M 6.5 2 C 5.1309372 2 4 3.1309372 4 4.5 L 4 19.5 C 4 20.869063 5.1309372 22 6.5 22 L 17.5 22 C 18.869063 22 20 20.869063 20 19.5 L 20 8 A 1.0001 1.0001 0 0 0 19.707031 7.2929688 L 14.707031 2.2929688 A 1.0001 1.0001 0 0 0 14 2 L 6.5 2 z M 6.5 4 L 13 4 L 13 8 A 1.0001 1.0001 0 0 0 14 9 L 18 9 L 18 19.5 C 18 19.786937 17.786937 20 17.5 20 L 6.5 20 C 6.2130628 20 6 19.786937 6 19.5 L 6 4.5 C 6 4.2130628 6.2130628 4 6.5 4 z M 15 5.4140625 L 16.585938 7 L 15 7 L 15 5.4140625 z M 9 10 A 1.0001 1.0001 0 1 0 9 12 L 15 12 A 1.0001 1.0001 0 1 0 15 10 L 9 10 z M 9 13 A 1.0001 1.0001 0 1 0 9 15 L 15 15 A 1.0001 1.0001 0 1 0 15 13 L 9 13 z M 9 16 A 1.0001 1.0001 0 1 0 9 18 L 13 18 A 1.0001 1.0001 0 1 0 13 16 L 9 16 z"></path>
                                </svg>
                                <span style="color: #222;">ÏûêÏÑ∏Ìïú ÎÇ¥Ïö©ÏùÄ <span style="color: var(--namu-green);">${linkText}</span> Î¨∏ÏÑúÎ•º Ï∞∏Í≥†ÌïòÏã≠ÏãúÏò§.</span>
                            </div>
                        `;
                        break;
                    case 'image':
                        const imgSrc = section.imageFile || section.imageUrl;
                        if (imgSrc) {
                            const widthStyle = section.imageWidth ? `style="width: ${section.imageWidth}px; height: auto; display: block; margin: 20px auto;"` : '';
                            sectionHTML = `<img src="${imgSrc}" class="wiki-image" alt="Ïù¥ÎØ∏ÏßÄ" ${widthStyle}>`;
                        }
                        break;
                    case 'table':
                        if (section.tableData && section.tableData.data.length > 0) {
                            const tableWidth = section.tableData.width || 700;
                            sectionHTML = `<table class="wiki-table" style="max-width: ${tableWidth}px;"><tbody>`;
                            
                            const mergeInfo = section.tableData.mergeInfo || [];
                            const cellStyles = section.tableData.cellStyles || {};
                            const skippedCells = new Set();
                            
                            section.tableData.data.forEach((row, rowIdx) => {
                                sectionHTML += '<tr>';
                                row.forEach((cell, cellIdx) => {
                                    const cellKey = `${rowIdx}-${cellIdx}`;
                                    
                                    if (skippedCells.has(cellKey)) {
                                        return;
                                    }
                                    
                                    const merge = mergeInfo.find(m => m.row === rowIdx && m.col === cellIdx);
                                    const isHeader = cellStyles[cellKey]?.isHeader || false;
                                    
                                    let colspan = 1;
                                    let rowspan = 1;
                                    
                                    if (merge) {
                                        colspan = merge.colspan;
                                        rowspan = merge.rowspan;
                                        
                                        for (let r = rowIdx; r < rowIdx + rowspan; r++) {
                                            for (let c = cellIdx; c < cellIdx + colspan; c++) {
                                                if (r !== rowIdx || c !== cellIdx) {
                                                    skippedCells.add(`${r}-${c}`);
                                                }
                                            }
                                        }
                                    }
                                    
                                    const colspanAttr = colspan > 1 ? ` colspan="${colspan}"` : '';
                                    const rowspanAttr = rowspan > 1 ? ` rowspan="${rowspan}"` : '';
                                    const tag = isHeader ? 'th' : 'td';
                                    
                                    // Ïù¥ÎØ∏ÏßÄ ÌÅ¨Í∏∞ Ï†ÅÏö©
                                    let cellContent = cell || '';
                                    if (cellContent.startsWith('<img') && cellStyles[cellKey]?.imageWidth) {
                                        const width = cellStyles[cellKey].imageWidth;
                                        cellContent = cellContent.replace('<img', `<img style="width: ${width}px; height: auto;"`);
                                    }
                                    
                                    sectionHTML += `<${tag}${colspanAttr}${rowspanAttr}>${cellContent}</${tag}>`;
                                });
                                sectionHTML += '</tr>';
                            });
                            sectionHTML += '</tbody></table>';
                        }
                        break;
                }

                if (sectionHTML) {
                    container.innerHTML += sectionHTML;
                }
            });

            document.getElementById('tocList').innerHTML = tocHTML || '<li style="color: #999;">Î™©Ï∞®Í∞Ä ÎπÑÏñ¥ÏûàÏäµÎãàÎã§</li>';
        }

        // Ï∫°Ï≤ò Í∏∞Îä•
        async function captureWiki() {
            const preview = document.getElementById('wiki-preview');
            try {
                const canvas = await html2canvas(preview, {
                    backgroundColor: '#ffffff',
                    scale: 1
                });
                
                const link = document.createElement('a');
                link.download = `wiki-${Date.now()}.png`;
                link.href = canvas.toDataURL();
                link.click();
                
                alert('‚úÖ Ï∫°Ï≤òÍ∞Ä ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!');
            } catch (error) {
                alert('‚ùå Ï∫°Ï≤ò Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                console.error(error);
            }
        }

        // Ï†ÄÏû• Í∏∞Îä•
        function saveWiki() {
            const data = {
                pageTitle: document.getElementById('pageTitle').value,
                categories: document.getElementById('categories').value,
                lastModified: document.getElementById('lastModified').value,
                introImageUrl: document.getElementById('introImageUrl').value,
                introGroupNameEn: document.getElementById('introGroupNameEn').value,
                introGroupNameKo: document.getElementById('introGroupNameKo').value,
                introMembers: document.getElementById('introMembers').value,
                profileImageUrl: document.getElementById('profileImageUrl').value,
                profileRows: profileRows,
                sections: sections,
                theme: document.getElementById('themeColor').value
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `wiki-${Date.now()}.json`;
            link.click();
            URL.revokeObjectURL(url);
            
            alert('‚úÖ ÌååÏùºÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!');
        }

        // Î∂àÎü¨Ïò§Í∏∞ Í∏∞Îä•
        function loadWiki() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    try {
                        const data = JSON.parse(event.target.result);
                        
                        document.getElementById('pageTitle').value = data.pageTitle || '';
                        document.getElementById('categories').value = data.categories || '';
                        document.getElementById('lastModified').value = data.lastModified || '';
                        document.getElementById('introImageUrl').value = data.introImageUrl || '';
                        document.getElementById('introGroupNameEn').value = data.introGroupNameEn || '';
                        document.getElementById('introGroupNameKo').value = data.introGroupNameKo || '';
                        document.getElementById('introMembers').value = data.introMembers || '';
                        document.getElementById('profileImageUrl').value = data.profileImageUrl || '';
                        
                        if (data.theme) {
                            document.getElementById('themeColor').value = data.theme;
                            document.getElementById('themeColorText').value = data.theme;
                            applyTheme(data.theme);
                        }
                        
                        // ÌîÑÎ°úÌïÑ Î≥µÏõê
                        profileRows = data.profileRows || [];
                        profileRowCounter = Math.max(...profileRows.map(r => r.id), 0);
                        document.getElementById('profile-rows-list').innerHTML = '';
                        profileRows.forEach(row => renderProfileRowEditor(row));
                        updateProfilePreview();
                        
                        // ÏÑπÏÖò Î≥µÏõê
                        sections = data.sections || [];
                        sectionCounter = Math.max(...sections.map(s => s.id), 0);
                        document.getElementById('sections-list').innerHTML = '';
                        sections.forEach(section => {
                            renderSectionEditor(section);
                            if (section.type === 'heading') {
                                document.getElementById(`level-${section.id}`).value = section.level;
                                document.getElementById(`title-${section.id}`).value = section.title;
                            } else if (section.type === 'text') {
                                document.getElementById(`content-${section.id}`).value = section.content;
                            } else if (section.type === 'image') {
                                document.getElementById(`imageUrl-${section.id}`).value = section.imageUrl || '';
                                if (section.imageFile) {
                                    document.getElementById(`imagePreview-${section.id}`).src = section.imageFile;
                                    document.getElementById(`imagePreview-${section.id}`).style.display = 'block';
                                }
                            } else if (section.type === 'table') {
                                document.getElementById(`tableCols-${section.id}`).value = section.tableData.cols;
                                document.getElementById(`tableRows-${section.id}`).value = section.tableData.rows;
                            }
                        });
                        
                        document.querySelector('.wiki-title').textContent = data.pageTitle;
                        
                        if (data.profileImageUrl) {
                            document.getElementById('previewProfileImage').innerHTML = 
                                `<img src="${data.profileImageUrl}" alt="ÌîÑÎ°úÌïÑ">`;
                        }
                        
                        // Î∂ÑÎ•ò Î∞è Î©îÌÉÄ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
                        const cats = data.categories.split(',').map(c => c.trim()).filter(c => c);
                        let catsHTML = '<span style="color: #222; font-weight: normal;">Î∂ÑÎ•ò:</span> ';
                        catsHTML += cats.map(cat => `<span class="wiki-category-item">${cat}</span>`).join(' | ');
                        document.getElementById('wikiCategories').innerHTML = catsHTML;
                        document.getElementById('lastModifiedPreview').textContent = `ÏµúÍ∑º ÏàòÏ†ï: ${data.lastModified}`;
                        
                        // ÌäπÏàò Ìëú Î≥µÏõê
                        if (data.introImageUrl) {
                            document.getElementById('introImagePreview').innerHTML = 
                                `<img src="${data.introImageUrl}" style="max-height: 60px; border-radius: 6px;">`;
                        }
                        document.getElementById('introGroupNameEnPreview').textContent = data.introGroupNameEn || '';
                        document.getElementById('introGroupNameKoPreview').textContent = data.introGroupNameKo || '';
                        const members = data.introMembers.split(',').map(m => m.trim()).filter(m => m);
                        const membersHTML = members.map(m => `<div class="member-item">${m}</div>`).join('');
                        document.getElementById('introMembersPreview').innerHTML = membersHTML;
                        
                        updatePreview();
                        alert('‚úÖ ÌååÏùºÏùÑ Î∂àÎü¨ÏôîÏäµÎãàÎã§!');
                    } catch (error) {
                        alert('‚ùå ÌååÏùºÏùÑ ÏùΩÎäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                        console.error(error);
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }

        // Ï¥àÍ∏∞Ìôî
        initializeProfile();
        updatePreview();
    </script>
</body>
</html>

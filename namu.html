<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚˜ë¬´ìœ„í‚¤ ìŠ¤íƒ€ì¼ ì—ë””í„°</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css" rel="stylesheet">
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --namu-green: #2db400;
            --namu-light-green: #e8f5e9;
            --namu-dark-green: #1e7e34;
            --border-color: #ddd;
            --text-color: #222;
            --bg-color: #fff;
            --table-header-bg: var(--namu-green);
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* ì™¼ìª½ í¸ì§‘ íŒ¨ë„ */
        .editor-panel {
            width: 400px;
            background: #f8f9fa;
            border-right: 2px solid var(--border-color);
            overflow-y: auto;
            padding: 20px;
        }

        .editor-panel h2 {
            color: var(--namu-green);
            margin-bottom: 20px;
            font-size: 24px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 5px;
            color: #555;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-family: inherit;
            font-size: 14px;
        }

        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }

        .image-upload-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .image-preview {
            width: 100%;
            max-height: 200px;
            object-fit: cover;
            border-radius: 4px;
            display: none;
        }

        .image-preview.show {
            display: block;
        }

        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 20px 0;
        }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }

        .btn-primary {
            background: var(--namu-green);
            color: white;
        }

        .btn-primary:hover {
            background: var(--namu-dark-green);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #545b62;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .section-item {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 4px;
            border: 1px solid var(--border-color);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .section-type {
            font-weight: 700;
            color: var(--namu-green);
        }

        .color-theme {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid var(--border-color);
        }

        .color-input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .color-input-group input[type="color"] {
            width: 60px;
            height: 40px;
            border: none;
            cursor: pointer;
        }

        /* ì˜¤ë¥¸ìª½ í”„ë¦¬ë·° íŒ¨ë„ */
        .preview-panel {
            flex: 1;
            overflow-y: auto;
            background: var(--bg-color);
        }

        #wiki-preview {
            max-width: 1000px;
            width: 1000px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        /* ë‚˜ë¬´ìœ„í‚¤ ìŠ¤íƒ€ì¼ */
        .wiki-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
            margin-bottom: 10px;
        }

        .wiki-title {
            font-size: 36px;
            font-weight: 700;
            color: var(--text-color);
            margin: 0;
        }

        .wiki-header-menu {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .wiki-header-menu span {
            color: #666;
            font-size: 14px;
            cursor: default;
        }

        .wiki-header-menu span:not(:last-child)::after {
            content: '';
            display: inline-block;
            width: 1px;
            height: 12px;
            background: #ddd;
            margin-left: 15px;
            vertical-align: middle;
        }

        .wiki-meta {
            display: flex;
            gap: 15px;
            font-size: 13px;
            color: #666;
            margin-bottom: 15px;
        }

        .wiki-category {
            background: white;
            padding: 8px 0;
            margin-bottom: 15px;
            font-size: 14px;
            border: none;
        }

        .wiki-category-item {
            color: var(--namu-green);
        }

        .wiki-content {
            display: flex;
            gap: 30px;
            align-items: flex-start;
            margin-bottom: 40px;
        }

        .wiki-main {
            flex: 1;
            min-width: 0;
        }

        .wiki-full-content {
            clear: both;
            width: 100%;
        }

        .wiki-toc {
            background: white;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid #ddd;
            max-width: 190px;
        }

        .wiki-toc-title {
            font-size: 18px;
            font-weight: 700;
            color: #222;
            margin-bottom: 15px;
        }

        .wiki-toc-list {
            list-style: none;
        }

        .wiki-toc-list li {
            padding: 4px 0;
            color: #222;
        }

        .wiki-toc-list .toc-number {
            color: var(--namu-green);
            font-weight: 700;
            margin-right: 5px;
        }

        .wiki-toc-list .toc-level-2 {
            margin-left: 20px;
        }

        .wiki-toc-list .toc-level-3 {
            margin-left: 40px;
        }

        .profile-box {
            width: 350px;
            background: white;
            border: 2px solid var(--namu-green);
            overflow: hidden;
            position: sticky;
            top: 20px;
        }

        .profile-image {
            width: 100%;
            height: 350px;
            object-fit: cover;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
        }

        .profile-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-table {
            width: 100%;
            border-collapse: collapse;
        }

        .profile-table tr {
            border-bottom: 1px solid var(--border-color);
        }

        .profile-table tr:last-child {
            border-bottom: none;
        }

        .profile-table th {
            background: var(--table-header-bg);
            color: #222;
            padding: 5px 10px;
            text-align: center;
            font-weight: 500;
            width: 35%;
        }

        .profile-table td {
            padding: 5px 10px;
            background: white;
            line-height: 1.4;
        }

        .wiki-section {
            margin-bottom: 5px;
        }

        .wiki-heading {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-color);
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid #ddd;
        }

        .wiki-heading-2 {
            font-size: 24px;
            margin-top: 25px;
        }

        .wiki-heading-3 {
            font-size: 20px;
            margin-top: 20px;
            border-bottom: 1px solid #ddd;
        }

        .wiki-text {
            line-height: 1.8;
            color: var(--text-color);
            margin-bottom: 10px;
        }

        .wiki-text blockquote {
            border-left: 3px solid var(--namu-green);
            padding-left: 15px;
            margin: 0;
            color: #666;
            font-style: italic;
            display: inline-block;
        }

        .intro-table {
            width: 700px;
            max-width: 700px;
            border: none;
            border-radius: 8px;
            overflow: hidden;
            margin: 20px auto;
            border-collapse: separate;
            border-spacing: 0;
            background: var(--namu-green);
            padding: 0 0 10px;
            text-align: center;
        }

        .intro-table td {
            padding: 5px 10px;
            text-align: center;
            border: none;
        }

        .intro-table .intro-first-row {
            margin: 0;
            padding: 0;
        }

        .intro-table .intro-row1 {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            color: white;
            padding: 10px 0 7px 0;
        }

        .intro-table .intro-image {
            flex: 0 0 auto;
        }

        .intro-table .intro-divider {
            font-size: 40px;
            color: #222;
            font-weight: 100;
            line-height: 1;
            align-self: center;
            position: relative;
            top: -4px;
        }

        .intro-table .intro-name {
            flex: 0 0 auto;
            font-size: 18px;
            font-weight: 700;
            display: flex;
            flex-direction: column;
            gap: 2px;
            align-items: flex-start;
            text-align: left;
            color: #222;
        }

        .intro-table .intro-name-en {
            font-size: 18px;
            font-weight: 700;
        }

        .intro-table .intro-name-ko {
            font-size: 14px;
            font-weight: 400;
        }

        .intro-table .intro-members {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
            padding: 0 0 8px 0;
            color: #222;
            border-bottom: 2px solid rgba(0, 0, 0, 0.2);
            margin: 0 10px;
        }

        .intro-table .member-item {
            background: transparent;
            padding: 0;
            font-size: 14px;
            flex: 1;
            text-align: center;
        }

        .intro-table .intro-links {
            display: flex;
            justify-content: space-around;
            gap: 10px;
            padding: 10px 0 5px 0;
            color: #222;
        }

        .intro-table .intro-link-item {
            font-size: 13px;
            font-weight: 700;
        }

        .wiki-table {
            width: 100%;
            max-width: 700px;
            border-collapse: collapse;
            margin: 20px auto;
            border: 2px solid var(--namu-green);
        }

        .wiki-table th {
            background: var(--table-header-bg);
            color: #222;
            padding: 5px 10px;
            font-weight: 500;
            border: 1px solid var(--border-color);
        }

        .wiki-table td {
            padding: 5px 10px;
            border: 1px solid var(--border-color);
            background: white;
        }

        .wiki-table td img {
            display: block;
            margin: 0 auto;
            max-width: 100%;
            height: auto;
        }

        .wiki-image {
            max-width: 100%;
            height: auto;
            margin: 20px auto;
            display: block;
            border-radius: 4px;
            border: 1px solid var(--border-color);
        }

        .action-buttons {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .fab-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            background: var(--namu-green);
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transition: all 0.3s;
        }

        .fab-btn:hover {
            background: var(--namu-dark-green);
            transform: scale(1.1);
        }

        .section-number {
            color: var(--namu-green);
            margin-right: 8px;
        }

        .wiki-category {
            background: var(--namu-light-green);
            padding: 8px 12px;
            border-radius: 4px;
            margin-bottom: 10px;
            font-size: 14px;
            color: #666;
            border: 1px solid var(--border-color);
        }

        .wiki-meta {
            display: flex;
            gap: 15px;
            font-size: 13px;
            color: #666;
            margin-bottom: 10px;
        }

        .wiki-meta-item {
            cursor: pointer;
        }

        .wiki-meta-item:hover {
            color: var(--namu-green);
        }

        .collapse-icon {
            display: inline;
        }

        .collapse-icon:before {
            color: #666;
            content: "\f3d0";
            float: left;
            font-family: "Ionicons";
            font-size: .8em;
            font-weight: 400;
            line-height: 1.8em;
            margin: 0 .5rem 0 .2rem;
            text-align: center;
            width: .9em;
        }

        .sortable-sections {
            min-height: 50px;
        }

        .drag-handle {
            cursor: move;
            color: #999;
            margin-right: 10px;
        }

        .text-toolbar {
            display: flex;
            gap: 5px;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }

        .text-toolbar button {
            padding: 5px 10px;
            border: 1px solid var(--border-color);
            background: white;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }

        .text-toolbar button:hover {
            background: var(--namu-light-green);
        }

        .table-cell-wrapper {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .merge-controls {
            position: absolute;
            top: 2px;
            right: 2px;
            display: flex;
            gap: 2px;
            z-index: 10;
        }

        .merge-btn {
            width: 20px;
            height: 20px;
            border: 1px solid #ccc;
            background: white;
            border-radius: 3px;
            cursor: pointer;
            font-size: 10px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .merge-btn:hover {
            background: var(--namu-light-green);
        }

        .merge-btn.active {
            background: var(--namu-green);
            color: white;
            border-color: var(--namu-green);
        }

        .profile-row-item {
            background: white;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .profile-row-item input {
            flex: 1;
            min-width: 0;
            max-width: 100%;
        }

        .profile-row-item .btn {
            padding: 5px 10px;
            font-size: 12px;
            flex-shrink: 0;
        }
    </style>
</head>
<body>
    <!-- ì™¼ìª½ í¸ì§‘ íŒ¨ë„ -->
    <div class="editor-panel">
        <h2>ğŸ“ ìœ„í‚¤ ì—ë””í„°</h2>
        
        <!-- ê¸°ë³¸ í”„ë¡œí•„ ì •ë³´ -->
        <div class="form-group">
            <label>ì œëª©</label>
            <input type="text" id="pageTitle" placeholder="í˜ì´ì§€ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" value="RIIZE">
        </div>

        <div class="form-group">
            <label>ë¶„ë¥˜ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
            <input type="text" id="categories" placeholder="ì˜ˆ: K-POP, ì•„ì´ëŒ, SM Entertainment" value="K-POP, ë³´ì´ê·¸ë£¹, SM">
        </div>

        <div class="form-group">
            <label>ì†Œê°œ í‘œ - ë¡œê³  ì´ë¯¸ì§€</label>
            <input type="file" id="introImageFile" accept="image/*">
            <input type="text" id="introImageUrl" placeholder="ë˜ëŠ” ì´ë¯¸ì§€ URL" style="margin-top: 5px;">
        </div>

        <div class="form-group">
            <label>í—¤ë” ê¸€ì”¨ìƒ‰ (ì†Œê°œí‘œ/í”„ë¡œí•„/ë³¸ë¬¸í‘œ)</label>
            <select id="headerTextColor">
                <option value="#222" selected>ê²€ì •</option>
                <option value="#fff">í°ìƒ‰</option>
            </select>
        </div>

        <div class="form-group">
            <label>ì†Œê°œ í‘œ - ê·¸ë£¹ëª… (ì˜ì–´)</label>
            <input type="text" id="introGroupNameEn" placeholder="ì˜ì–´ ê·¸ë£¹ëª…" value="RIIZE">
        </div>

        <div class="form-group">
            <label>ì†Œê°œ í‘œ - ê·¸ë£¹ëª… (í•œê¸€)</label>
            <input type="text" id="introGroupNameKo" placeholder="í•œê¸€ ê·¸ë£¹ëª…" value="ë¼ì´ì¦ˆ">
        </div>

        <div class="form-group">
            <label>ì†Œê°œ í‘œ - ë©¤ë²„ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
            <input type="text" id="introMembers" placeholder="ì˜ˆ: ì‡¼íƒ€ë¡œ, ì€ì„, ì„±ì°¬..." value="ì‡¼íƒ€ë¡œ, ì€ì„, ì„±ì°¬, ì›ë¹ˆ, ìŠ¹í•œ, ì•¤í†¤">
        </div>

        <div class="form-group">
            <label>ìµœê·¼ ìˆ˜ì • ì‹œê°</label>
            <input type="text" id="lastModified" placeholder="ìµœê·¼ ìˆ˜ì • ì‹œê°" value="2025-12-06 15:30:25">
        </div>

        <div class="form-group">
            <label>í”„ë¡œí•„ ì´ë¯¸ì§€</label>
            <div class="image-upload-group">
                <input type="file" id="profileImage" accept="image/*">
                <input type="text" id="profileImageUrl" placeholder="ë˜ëŠ” ì´ë¯¸ì§€ URL ì…ë ¥">
                <img id="profileImagePreview" class="image-preview">
            </div>
        </div>

        <div class="form-group">
            <label>ë°ë·”ì¼ (ìë™ ê³„ì‚°)</label>
            <input type="date" id="debutDate" value="2023-09-04">
            <div id="debutDaysInfo" style="font-size: 12px; color: #666; margin-top: 5px;"></div>
        </div>

        <div class="form-group">
            <button class="btn btn-primary" onclick="addProfileRow()" style="width: 100%;">â• í”„ë¡œí•„ í•­ëª© ì¶”ê°€</button>
        </div>

        <div id="profile-rows-list">
            <!-- ë™ì ìœ¼ë¡œ ì¶”ê°€ë˜ëŠ” í”„ë¡œí•„ í–‰ë“¤ -->
        </div>

        <h2 style="margin-top: 30px;">â• ì„¹ì…˜ ì¶”ê°€</h2>
        <div class="button-group">
            <button class="btn btn-primary" onclick="addSection('heading')">ğŸ“Œ ì œëª©</button>
            <button class="btn btn-primary" onclick="addSection('text')">ğŸ“„ í…ìŠ¤íŠ¸</button>
            <button class="btn btn-primary" onclick="addSection('collapse')">ğŸ“‹ ì¶•ì•½</button>
            <button class="btn btn-primary" onclick="addSection('table')">ğŸ“Š í‘œ</button>
            <button class="btn btn-primary" onclick="addSection('image')">ğŸ–¼ï¸ ì´ë¯¸ì§€</button>
        </div>

        <!-- ì¶”ê°€ëœ ì„¹ì…˜ ëª©ë¡ -->
        <div id="sections-list" class="sortable-sections"></div>

        <!-- í…Œë§ˆ ì„¤ì • -->
        <div class="color-theme">
            <h2>ğŸ¨ í…Œë§ˆ ì„¤ì •</h2>
            <div class="form-group">
                <label>ë©”ì¸ ì»¬ëŸ¬</label>
                <div class="color-input-group">
                    <input type="color" id="themeColor" value="#2db400">
                    <input type="text" id="themeColorText" value="#2db400">
                </div>
            </div>
        </div>
    </div>

    <!-- ì˜¤ë¥¸ìª½ í”„ë¦¬ë·° íŒ¨ë„ -->
    <div class="preview-panel">
        <div id="wiki-preview">
            <!-- 1. ëŒ€ì œëª© -->
            <div class="wiki-header">
                <h1 class="wiki-title">RIIZE</h1>
                <div class="wiki-header-menu">
                    <span style="display: flex; align-items: center; gap: 3px;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 512 512" style="fill: #666;">
                            <!-- Font Awesome Free (CC BY 4.0) -->
                            <path d="M224 256A128 128 0 1 0 224 0a128 128 0 1 0 0 256zm-45.7 48C79.8 304 0 383.8 0 482.3C0 498.7 13.3 512 29.7 512H322.8c-3.1-8.8-3.7-18.4-1.4-27.8l15-60.1c2.8-11.3 8.6-21.5 16.8-29.7l40.3-40.3c-32.1-31-75.7-50.1-123.9-50.1H178.3zm435.5-68.3c-15.6-15.6-40.9-15.6-56.6 0l-29.4 29.4 71 71 29.4-29.4c15.6-15.6 15.6-40.9 0-56.6l-14.4-14.4zM375.9 417c-4.1 4.1-7 9.2-8.4 14.9l-15 60.1c-1.4 5.5 .2 11.2 4.2 15.2s9.7 5.6 15.2 4.2l60.1-15c5.6-1.4 10.8-4.3 14.9-8.4L576.1 358.7l-71-71L375.9 417z"/>
                        </svg>
                        í¸ì§‘
                    </span>
                    <span style="display: flex; align-items: center; gap: 3px;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 512 512" style="fill: #666;">
                            <!-- Font Awesome Free (CC BY 4.0) -->
                            <path d="M208 352c114.9 0 208-78.8 208-176S322.9 0 208 0S0 78.8 0 176c0 38.6 14.7 74.3 39.6 103.4c-3.5 9.4-8.7 17.7-14.2 24.7c-4.8 6.2-9.7 11-13.3 14.3c-1.8 1.6-3.3 2.9-4.3 3.7c-.5 .4-.9 .7-1.1 .8l-.2 .2 0 0 0 0C1 327.2-1.4 334.4 .8 340.9S9.1 352 16 352c21.8 0 43.8-5.6 62.1-12.5c9.2-3.5 17.8-7.4 25.3-11.4C134.1 343.3 169.8 352 208 352zM448 176c0 112.3-99.1 196.9-216.5 207C255.8 457.4 336.4 512 432 512c38.2 0 73.9-8.7 104.7-23.9c7.5 4 16 7.9 25.2 11.4c18.3 6.9 40.3 12.5 62.1 12.5c6.9 0 13.1-4.5 15.2-11.1c2.1-6.6-.2-13.8-5.8-17.9l0 0 0 0-.2-.2c-.2-.2-.6-.4-1.1-.8c-1-.8-2.5-2-4.3-3.7c-3.6-3.3-8.5-8.1-13.3-14.3c-5.5-7-10.7-15.4-14.2-24.7c24.9-29 39.6-64.7 39.6-103.4c0-92.8-84.9-168.9-192.6-175.5c.4 5.1 .6 10.3 .6 15.5z"/>
                        </svg>
                        í† ë¡ 
                    </span>
                    <span style="display: flex; align-items: center; gap: 3px;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 448 512" style="fill: #666;">
                            <!-- Font Awesome Free (CC BY 4.0) -->
                            <path d="M96 0C43 0 0 43 0 96V416c0 53 43 96 96 96H384h32c17.7 0 32-14.3 32-32s-14.3-32-32-32V384c17.7 0 32-14.3 32-32V32c0-17.7-14.3-32-32-32H384 96zm0 384H352v64H96c-17.7 0-32-14.3-32-32s14.3-32 32-32zm32-240c0-8.8 7.2-16 16-16H336c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16zm16 48H336c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16s7.2-16 16-16z"/>
                        </svg>
                        ì—­ì‚¬
                    </span>
                    <span style="font-size: 18px; font-weight: 700;">â‹¯</span>
                </div>
            </div>

            <!-- 2. ìµœê·¼ ìˆ˜ì • -->
            <div class="wiki-meta">
                <span id="lastModifiedPreview">ìµœê·¼ ìˆ˜ì •: 2025-12-06 15:30:25</span>
            </div>

            <!-- 3. ë¶„ë¥˜ -->
            <div id="wikiCategories" class="wiki-category" style="background: white !important; border-radius: 4px !important; padding: 8px 12px !important; border: 1px solid #ddd !important;">
                <span style="color: #222; font-weight: normal;">ë¶„ë¥˜:</span>
                <span class="wiki-category-item">K-POP</span> | 
                <span class="wiki-category-item">ë³´ì´ê·¸ë£¹</span> | 
                <span class="wiki-category-item">SM</span>
            </div>

            <!-- 4. íŠ¹ìˆ˜ í‘œ (ì•„ì´ëŒ ì†Œê°œìš©) -->
            <table class="intro-table">
                <tr>
                    <td>
                        <div class="intro-first-row">
                            <div class="intro-row1">
                                <div class="intro-image" id="introImagePreview">ë¡œê³ </div>
                                <div class="intro-divider">|</div>
                                <div class="intro-name">
                                    <div class="intro-name-en" id="introGroupNameEnPreview">RIIZE</div>
                                    <div class="intro-name-ko" id="introGroupNameKoPreview">ë¼ì´ì¦ˆ</div>
                                </div>
                            </div>
                        </div>
                        <div class="intro-members" id="introMembersPreview">
                            <div class="member-item">ì‡¼íƒ€ë¡œ</div>
                            <div class="member-item">ì€ì„</div>
                            <div class="member-item">ì„±ì°¬</div>
                            <div class="member-item">ì›ë¹ˆ</div>
                            <div class="member-item">ìŠ¹í•œ</div>
                            <div class="member-item">ì•¤í†¤</div>
                        </div>
                        <div class="intro-links">
                            <span class="intro-link-item">[ í•œêµ­ ìŒë°˜ ]</span>
                            <span class="intro-link-item">[ ì°¸ì—¬ ìŒë°˜ ]</span>
                            <span class="intro-link-item">[ ê´€ë ¨ ë¬¸ì„œ ]</span>
                        </div>
                    </td>
                </tr>
            </table>

            <!-- 5. ëª©ì°¨ + í”„ë¡œí•„ (ì„¸íŠ¸) -->
            <div class="wiki-content">
                <div class="wiki-main">
                    <div class="wiki-toc">
                        <div class="wiki-toc-title">ëª©ì°¨</div>
                        <ul class="wiki-toc-list" id="tocList">
                            <!-- ìë™ ìƒì„±ë¨ -->
                        </ul>
                    </div>
                </div>

                <aside class="profile-box">
                    <div style="background: var(--namu-green); padding: 10px;">
                        <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                            <div id="profileIntroImagePreview" style="flex: 0 0 auto;">ë¡œê³ </div>
                            <div class="profile-intro-divider" style="font-size: 40px; color: #222; font-weight: 100; line-height: 1; position: relative; top: -4px;">|</div>
                            <div style="flex: 0 0 auto; font-size: 18px; font-weight: 700; display: flex; flex-direction: column; gap: 2px; align-items: flex-start; text-align: left; color: #222;">
                                <div id="profileIntroNameEnPreview">RIIZE</div>
                                <div id="profileIntroNameKoPreview" style="font-size: 14px; font-weight: 400;">ë¼ì´ì¦ˆ</div>
                            </div>
                        </div>
                    </div>
                    <div class="profile-image" id="previewProfileImage">
                        í”„ë¡œí•„ ì´ë¯¸ì§€
                    </div>
                    <table class="profile-table" id="previewProfileTable">
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                    </table>
                </aside>
            </div>

            <!-- 6. ë³¸ë¬¸ (ëª©ì°¨+í”„ë¡œí•„ ì„¸íŠ¸ ì•„ë˜) -->
            <div class="wiki-full-content">
                <div id="dynamicContent">
                    <!-- ë™ì ìœ¼ë¡œ ì¶”ê°€ë˜ëŠ” ì½˜í…ì¸  -->
                </div>
            </div>
        </div>
    </div>

    <!-- í•˜ë‹¨ ì•¡ì…˜ ë²„íŠ¼ -->
    <div class="action-buttons">
        <button class="fab-btn" onclick="captureWiki()" title="ìº¡ì²˜">ğŸ“¸</button>
        <button class="fab-btn" onclick="saveWiki()" title="ì €ì¥">ğŸ’¾</button>
        <button class="fab-btn" onclick="loadWiki()" title="ë¶ˆëŸ¬ì˜¤ê¸°">ğŸ“‚</button>
    </div>

    <script>
        let sections = [];
        let sectionCounter = 0;
        let profileRows = [];
        let profileRowCounter = 0;
        let footnotes = []; // ê°ì£¼ ì €ì¥

        // ì´ˆê¸° í”„ë¡œí•„ í–‰ ì¶”ê°€
        function initializeProfile() {
            addProfileRow('ì†Œì†', 'SM Entertainment');
            addProfileRow('ë©¤ë²„', '6ëª…');
            addProfileRow('ì¥ë¥´', 'K-POP, R&B, Dance');
        }

        // í”„ë¡œí•„ í–‰ ì¶”ê°€
        function addProfileRow(header = '', value = '') {
            profileRowCounter++;
            const row = {
                id: profileRowCounter,
                header: header,
                value: value
            };
            profileRows.push(row);
            renderProfileRowEditor(row);
            updateProfilePreview();
        }

        function renderProfileRowEditor(row) {
            const container = document.getElementById('profile-rows-list');
            const rowDiv = document.createElement('div');
            rowDiv.className = 'profile-row-item';
            rowDiv.id = `profile-row-${row.id}`;
            
            // ë°ë·” í–‰ì€ ì…ë ¥ í•„ë“œ í‘œì‹œ ì•ˆ í•¨
            if (row.header === 'ë°ë·”') {
                rowDiv.innerHTML = `
                    <div style="padding: 10px; background: #f0f0f0; border-radius: 4px; color: #666; font-size: 13px;">
                        â° ë°ë·”ì¼ì€ ë‹¬ë ¥ì—ì„œ ìë™ ì„¤ì •ë©ë‹ˆë‹¤
                    </div>
                `;
            } else {
                rowDiv.innerHTML = `
                    <input type="text" placeholder="í•­ëª©ëª…" value="${row.header}" 
                           onkeyup="updateProfileRow(${row.id}, 'header', this.value)">
                    <input type="text" placeholder="ë‚´ìš©" value="${row.value}" 
                           onkeyup="updateProfileRow(${row.id}, 'value', this.value)">
                    <button class="btn btn-danger" onclick="removeProfileRow(${row.id})">Ã—</button>
                `;
            }
            
            container.appendChild(rowDiv);
        }

        function updateProfileRow(rowId, field, value) {
            const row = profileRows.find(r => r.id === rowId);
            if (row) {
                row[field] = value;
                updateProfilePreview();
            }
        }

        function removeProfileRow(rowId) {
            profileRows = profileRows.filter(r => r.id !== rowId);
            document.getElementById(`profile-row-${rowId}`).remove();
            updateProfilePreview();
        }

        function updateProfilePreview() {
            const table = document.getElementById('previewProfileTable');
            let html = '';
            
            profileRows.forEach(row => {
                if (row.header || row.value) {
                    html += `
                        <tr>
                            <th>${row.header}</th>
                            <td>${row.value}</td>
                        </tr>
                    `;
                }
            });
            
            table.innerHTML = html;
        }

        // ë¶„ë¥˜ ë° ë©”íƒ€ ì •ë³´ ì—…ë°ì´íŠ¸
        document.getElementById('categories').addEventListener('input', function() {
            const cats = this.value.split(',').map(c => c.trim()).filter(c => c);
            let html = '<span style="color: #222; font-weight: normal;">ë¶„ë¥˜:</span> ';
            html += cats.map(cat => `<span class="wiki-category-item">${cat}</span>`).join(' | ');
            document.getElementById('wikiCategories').innerHTML = html;
        });

        document.getElementById('lastModified').addEventListener('input', function() {
            document.getElementById('lastModifiedPreview').textContent = `ìµœê·¼ ìˆ˜ì •: ${this.value}`;
        });

        // í—¤ë” ê¸€ì”¨ìƒ‰ ë³€ê²½ (ì†Œê°œí‘œ + í”„ë¡œí•„ + ë³¸ë¬¸í‘œ)
        document.getElementById('headerTextColor').addEventListener('change', function() {
            const color = this.value;
            
            // ì†Œê°œí‘œ ì „ì²´
            document.getElementById('introGroupNameEnPreview').style.color = color;
            document.getElementById('introGroupNameKoPreview').style.color = color;
            document.querySelectorAll('.intro-table .member-item').forEach(el => el.style.color = color);
            document.querySelectorAll('.intro-table .intro-link-item').forEach(el => el.style.color = color);
            document.querySelector('.intro-table .intro-divider').style.color = color;
            
            // ì†Œê°œí‘œ ê°€ë¡œì„ 
            const borderColor = color === '#fff' ? 'rgba(255, 255, 255, 0.3)' : 'rgba(0, 0, 0, 0.2)';
            document.querySelector('.intro-table .intro-members').style.borderBottomColor = borderColor;
            
            // í”„ë¡œí•„ ìƒë‹¨ ë¡œê³ |ì´ë¦„
            document.getElementById('profileIntroNameEnPreview').style.color = color;
            document.getElementById('profileIntroNameKoPreview').style.color = color;
            document.querySelector('.profile-intro-divider').style.color = color;
            
            // í”„ë¡œí•„ í—¤ë”
            document.querySelectorAll('.profile-table th').forEach(el => el.style.color = color);
            
            // ë³¸ë¬¸ í‘œ í—¤ë”
            document.querySelectorAll('.wiki-table th').forEach(el => el.style.color = color);
        });

        // íŠ¹ìˆ˜ í‘œ - ë¡œê³  ì´ë¯¸ì§€
        document.getElementById('introImageFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const imgHTML = `<img src="${event.target.result}" style="max-height: 60px; border-radius: 6px;">`;
                    document.getElementById('introImagePreview').innerHTML = imgHTML;
                    document.getElementById('profileIntroImagePreview').innerHTML = imgHTML;
                };
                reader.readAsDataURL(file);
            }
        });

        document.getElementById('introImageUrl').addEventListener('input', function() {
            if (this.value) {
                const imgHTML = `<img src="${this.value}" style="max-height: 60px; border-radius: 6px;">`;
                document.getElementById('introImagePreview').innerHTML = imgHTML;
                document.getElementById('profileIntroImagePreview').innerHTML = imgHTML;
            }
        });

        // íŠ¹ìˆ˜ í‘œ - ê·¸ë£¹ëª…
        document.getElementById('introGroupNameEn').addEventListener('input', function() {
            document.getElementById('introGroupNameEnPreview').textContent = this.value;
            document.getElementById('profileIntroNameEnPreview').textContent = this.value;
        });

        document.getElementById('introGroupNameKo').addEventListener('input', function() {
            document.getElementById('introGroupNameKoPreview').textContent = this.value;
            document.getElementById('profileIntroNameKoPreview').textContent = this.value;
        });

        // íŠ¹ìˆ˜ í‘œ - ë©¤ë²„
        document.getElementById('introMembers').addEventListener('input', function() {
            const members = this.value.split(',').map(m => m.trim()).filter(m => m);
            const html = members.map(m => `<div class="member-item">${m}</div>`).join('');
            document.getElementById('introMembersPreview').innerHTML = html;
        });

        // ì‹¤ì‹œê°„ í”„ë¦¬ë·° ì—…ë°ì´íŠ¸
        document.getElementById('pageTitle').addEventListener('input', function() {
            const title = this.value;
            document.querySelector('.wiki-title').textContent = title;
            
            // ìë™ìœ¼ë¡œ ì†Œê°œí‘œ ì˜ì–´ëª… ë™ê¸°í™”
            document.getElementById('introGroupNameEn').value = title;
            document.getElementById('introGroupNameEnPreview').textContent = title;
        });

        // ë°ë·”ì¼ ìë™ ê³„ì‚°
        document.getElementById('debutDate').addEventListener('change', function() {
            const debutDate = new Date(this.value);
            const today = new Date();
            const diffTime = today - debutDate;
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            
            // ë‚ ì§œ í¬ë§·íŒ… (YYYYë…„ Mì›” Dì¼)
            const year = debutDate.getFullYear();
            const month = debutDate.getMonth() + 1;
            const day = debutDate.getDate();
            const formattedDate = `${year}ë…„ ${month}ì›” ${day}ì¼`;
            
            // í”„ë¡œí•„ ë°ë·” í–‰ ì°¾ê¸° (ì—†ìœ¼ë©´ ìƒì„±)
            let debutRow = profileRows.find(row => row.header === 'ë°ë·”');
            if (!debutRow) {
                // ë§¨ ì•ì— ë°ë·” í–‰ ì¶”ê°€
                profileRowCounter++;
                debutRow = {
                    id: profileRowCounter,
                    header: 'ë°ë·”',
                    value: ''
                };
                profileRows.unshift(debutRow); // ë§¨ ì•ì— ì¶”ê°€
                renderProfileRowEditor(debutRow);
            }
            
            // ê°’ ì—…ë°ì´íŠ¸
            debutRow.value = `${formattedDate}<br><span style="font-size: 12px; color: #666; line-height: 1.2;">(ë°ë·”ì¼ë¡œë¶€í„° <strong>+${diffDays}</strong>ì¼)</span>`;
            
            // ì…ë ¥ í•„ë“œë„ ì—…ë°ì´íŠ¸
            const input = document.getElementById(`profile-value-${debutRow.id}`);
            if (input) {
                input.value = `${formattedDate} (ë°ë·” +${diffDays}ì¼)`;
            }
            
            updateProfilePreview();
            
            // ì •ë³´ í‘œì‹œ
            document.getElementById('debutDaysInfo').textContent = `ë°ë·” +${diffDays}ì¼`;
        });

        // ì´ˆê¸° ë¡œë“œì‹œ ë°ë·”ì¼ ê³„ì‚°
        document.getElementById('debutDate').dispatchEvent(new Event('change'));

        // í”„ë¡œí•„ ì´ë¯¸ì§€ ì—…ë¡œë“œ
        document.getElementById('profileImage').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = document.getElementById('profileImagePreview');
                    img.src = event.target.result;
                    img.classList.add('show');
                    
                    document.getElementById('previewProfileImage').innerHTML = 
                        `<img src="${event.target.result}" alt="í”„ë¡œí•„">`;
                };
                reader.readAsDataURL(file);
            }
        });

        document.getElementById('profileImageUrl').addEventListener('input', function() {
            if (this.value) {
                const img = document.getElementById('profileImagePreview');
                img.src = this.value;
                img.classList.add('show');
                
                document.getElementById('previewProfileImage').innerHTML = 
                    `<img src="${this.value}" alt="í”„ë¡œí•„">`;
            }
        });

        // í…Œë§ˆ ì»¬ëŸ¬ ë³€ê²½
        document.getElementById('themeColor').addEventListener('input', function() {
            document.getElementById('themeColorText').value = this.value;
            applyTheme(this.value);
        });

        document.getElementById('themeColorText').addEventListener('input', function() {
            document.getElementById('themeColor').value = this.value;
            applyTheme(this.value);
        });

        function applyTheme(color) {
            document.documentElement.style.setProperty('--namu-green', color);
            document.documentElement.style.setProperty('--table-header-bg', color);
            
            const lightColor = adjustColor(color, 40);
            document.documentElement.style.setProperty('--namu-light-green', lightColor);
        }

        function adjustColor(color, percent) {
            const num = parseInt(color.replace("#",""), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) + amt;
            const G = (num >> 8 & 0x00FF) + amt;
            const B = (num & 0x0000FF) + amt;
            return "#" + (0x1000000 + (R<255?R<1?0:R:255)*0x10000 +
                (G<255?G<1?0:G:255)*0x100 + (B<255?B<1?0:B:255))
                .toString(16).slice(1);
        }

        // ì„¹ì…˜ ì¶”ê°€
        function addSection(type) {
            sectionCounter++;
            const section = {
                id: sectionCounter,
                type: type,
                level: 1,
                title: '',
                content: '',
                collapseLink: '', // ì¶•ì•½ìš©
                imageFile: null,
                imageUrl: '',
                imageWidth: '', // ì´ë¯¸ì§€ ë„ˆë¹„
                tableData: { 
                    cols: 2,
                    rows: 2,
                    width: 700,
                    data: [['', ''], ['', '']],
                    cellStyles: {}, // { "row-col": { isHeader: true/false } }
                    mergeInfo: [] // { row, col, colspan, rowspan }
                }
            };
            sections.push(section);
            renderSectionEditor(section);
            updatePreview();
        }

        function renderSectionEditor(section) {
            const sectionsList = document.getElementById('sections-list');
            const sectionDiv = document.createElement('div');
            sectionDiv.className = 'section-item';
            sectionDiv.id = `section-${section.id}`;
            sectionDiv.draggable = true;

            let editorHTML = `
                <div class="section-header">
                    <span class="drag-handle">â˜°</span>
                    <span class="section-type">${getSectionTypeLabel(section.type)}</span>
                    <button class="btn btn-danger" onclick="removeSection(${section.id})" style="padding: 5px 10px; font-size: 12px;">ì‚­ì œ</button>
                </div>
            `;

            switch(section.type) {
                case 'heading':
                    editorHTML += `
                        <div class="form-group">
                            <label>ë ˆë²¨</label>
                            <select id="level-${section.id}" onchange="updateSectionData(${section.id}, 'level', this.value)">
                                <option value="1">H1 (##)</option>
                                <option value="2">H2 (###)</option>
                                <option value="3">H3 (####)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ì œëª©</label>
                            <input type="text" id="title-${section.id}" 
                                   placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" 
                                   onkeyup="updateSectionData(${section.id}, 'title', this.value)">
                        </div>
                    `;
                    break;
                case 'text':
                    editorHTML += `
                        <div class="form-group">
                            <label>ë‚´ìš©</label>
                            <div class="text-toolbar">
                                <button onclick="insertTextFormat(${section.id}, 'bold')"><b>B</b></button>
                                <button onclick="insertTextFormat(${section.id}, 'maincolor')">ğŸ¨ ëŒ€í‘œìƒ‰</button>
                                <button onclick="insertTextFormat(${section.id}, 'footnote')">ğŸ“ ê°ì£¼</button>
                                <button onclick="insertTextFormat(${section.id}, 'bullet')">â€¢ ë¶ˆë¦¿</button>
                                <button onclick="insertTextFormat(${section.id}, 'quote')">â ì¸ìš©</button>
                            </div>
                            <textarea id="content-${section.id}" 
                                      placeholder="í…ìŠ¤íŠ¸ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”&#10;&#10;ì„œì‹:&#10;*êµµê²Œ* = êµµê²Œ&#10;[ëŒ€í‘œìƒ‰] = ëŒ€í‘œìƒ‰&#10;{ê°ì£¼ë‚´ìš©} = ê°ì£¼&#10;- ë¶ˆë¦¿ = â€¢ ë¶ˆë¦¿&#10;-- ë¶ˆë¦¿2 = â—¦ ë¶ˆë¦¿ (2ë‹¨)&#10;> ì¸ìš©ë¬¸ = ì¸ìš©" 
                                      onkeyup="updateSectionData(${section.id}, 'content', this.value)"
                                      style="min-height: 120px;"></textarea>
                        </div>
                    `;
                    break;
                case 'collapse':
                    editorHTML += `
                        <div class="form-group">
                            <label>ë§í¬ í…ìŠ¤íŠ¸</label>
                            <input type="text" id="collapseLink-${section.id}" 
                                   placeholder="ì˜ˆ: ì´ê±° ì»¤ìŠ¤í…€" 
                                   onkeyup="updateSectionData(${section.id}, 'collapseLink', this.value)">
                        </div>
                    `;
                    break;
                case 'image':
                    editorHTML += `
                        <div class="form-group">
                            <label>ì´ë¯¸ì§€ íŒŒì¼</label>
                            <input type="file" id="imageFile-${section.id}" accept="image/*" 
                                   onchange="handleImageUpload(${section.id}, this)">
                        </div>
                        <div class="form-group">
                            <label>ë˜ëŠ” ì´ë¯¸ì§€ URL</label>
                            <input type="text" id="imageUrl-${section.id}" 
                                   placeholder="ì´ë¯¸ì§€ URLì„ ì…ë ¥í•˜ì„¸ìš”" 
                                   onkeyup="updateSectionData(${section.id}, 'imageUrl', this.value)">
                        </div>
                        <div class="form-group">
                            <label>ì´ë¯¸ì§€ ê°€ë¡œ í¬ê¸° (px)</label>
                            <input type="number" id="imageWidth-${section.id}" 
                                   placeholder="ë¹„ì›Œë‘ë©´ ìë™" 
                                   onkeyup="updateSectionData(${section.id}, 'imageWidth', this.value)"
                                   style="width: 150px;">
                        </div>
                        <img id="imagePreview-${section.id}" style="max-width: 100%; margin-top: 10px; display: none;">
                    `;
                    break;
                case 'table':
                    editorHTML += `
                        <div class="form-group">
                            <label>í‘œ í¬ê¸°</label>
                            <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                                <div>
                                    <label style="font-size: 12px;">ì—´:</label>
                                    <input type="number" id="tableCols-${section.id}" value="2" min="1" max="10" 
                                           style="width: 60px;" onchange="updateTableSize(${section.id})">
                                </div>
                                <div>
                                    <label style="font-size: 12px;">í–‰:</label>
                                    <input type="number" id="tableRows-${section.id}" value="2" min="1" max="20" 
                                           style="width: 60px;" onchange="updateTableSize(${section.id})">
                                </div>
                                <div>
                                    <label style="font-size: 12px;">ë„ˆë¹„(px):</label>
                                    <input type="number" id="tableWidth-${section.id}" value="700" min="100" max="1000" 
                                           style="width: 80px;" onchange="updateTableWidth(${section.id})">
                                </div>
                            </div>
                            <div id="table-editor-${section.id}"></div>
                        </div>
                    `;
                    break;
            }

            sectionDiv.innerHTML = editorHTML;
            
            // ë“œë˜ê·¸ ì´ë²¤íŠ¸ ì¶”ê°€
            sectionDiv.addEventListener('dragstart', handleDragStart);
            sectionDiv.addEventListener('dragover', handleDragOver);
            sectionDiv.addEventListener('drop', handleDrop);
            sectionDiv.addEventListener('dragend', handleDragEnd);
            
            sectionsList.appendChild(sectionDiv);

            if (section.type === 'table') {
                renderTableEditor(section);
            }
        }

        let draggedElement = null;

        function handleDragStart(e) {
            draggedElement = this;
            this.style.opacity = '0.4';
        }

        function handleDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.dataTransfer.dropEffect = 'move';
            return false;
        }

        function handleDrop(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }

            if (draggedElement !== this) {
                const allSections = [...document.querySelectorAll('.section-item')];
                const draggedIndex = allSections.indexOf(draggedElement);
                const targetIndex = allSections.indexOf(this);

                // sections ë°°ì—´ ìˆœì„œ ë³€ê²½
                const draggedSection = sections[draggedIndex];
                sections.splice(draggedIndex, 1);
                sections.splice(targetIndex, 0, draggedSection);

                // DOM ìˆœì„œ ë³€ê²½
                const container = document.getElementById('sections-list');
                if (draggedIndex < targetIndex) {
                    container.insertBefore(draggedElement, this.nextSibling);
                } else {
                    container.insertBefore(draggedElement, this);
                }

                updatePreview();
            }

            return false;
        }

        function handleDragEnd(e) {
            this.style.opacity = '1';
        }

        function getSectionTypeLabel(type) {
            const labels = {
                'heading': 'ğŸ“Œ ì œëª©',
                'text': 'ğŸ“„ í…ìŠ¤íŠ¸',
                'collapse': 'ğŸ“‹ ì¶•ì•½',
                'table': 'ğŸ“Š í‘œ',
                'image': 'ğŸ–¼ï¸ ì´ë¯¸ì§€'
            };
            return labels[type] || type;
        }

        function insertTextFormat(sectionId, format) {
            const textarea = document.getElementById(`content-${sectionId}`);
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const selectedText = textarea.value.substring(start, end);
            let replacement = '';

            switch(format) {
                case 'bold':
                    replacement = `*${selectedText || 'êµµê²Œ'}*`;
                    break;
                case 'maincolor':
                    replacement = `[${selectedText || 'ëŒ€í‘œìƒ‰'}]`;
                    break;
                case 'footnote':
                    replacement = `{${selectedText || 'ê°ì£¼ ë‚´ìš©'}}`;
                    break;
                case 'bullet':
                    replacement = `- ${selectedText || 'ë¶ˆë¦¿'}`;
                    break;
                case 'quote':
                    replacement = `> ${selectedText || 'ì¸ìš©ë¬¸'}`;
                    break;
            }

            if (replacement) {
                textarea.value = textarea.value.substring(0, start) + replacement + textarea.value.substring(end);
                textarea.setSelectionRange(start, start + replacement.length);
                updateSectionData(sectionId, 'content', textarea.value);
            }
        }

        function handleImageUpload(sectionId, input) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const section = sections.find(s => s.id === sectionId);
                    if (section) {
                        section.imageFile = e.target.result;
                        document.getElementById(`imagePreview-${sectionId}`).src = e.target.result;
                        document.getElementById(`imagePreview-${sectionId}`).style.display = 'block';
                        updatePreview();
                    }
                };
                reader.readAsDataURL(file);
            }
        }

        function updateSectionData(sectionId, field, value) {
            const section = sections.find(s => s.id === sectionId);
            if (section) {
                section[field] = value;
                updatePreview();
            }
        }

        function removeSection(sectionId) {
            sections = sections.filter(s => s.id !== sectionId);
            document.getElementById(`section-${sectionId}`).remove();
            updatePreview();
        }

        function updateTableSize(sectionId) {
            const section = sections.find(s => s.id === sectionId);
            if (!section) return;

            const newCols = parseInt(document.getElementById(`tableCols-${sectionId}`).value);
            const newRows = parseInt(document.getElementById(`tableRows-${sectionId}`).value);

            // í–‰ ì¡°ì •
            while (section.tableData.data.length < newRows) {
                section.tableData.data.push(new Array(newCols).fill(''));
            }
            section.tableData.data = section.tableData.data.slice(0, newRows);

            // ê° í–‰ì˜ ì—´ ìˆ˜ ì¡°ì •
            section.tableData.data = section.tableData.data.map(row => {
                while (row.length < newCols) row.push('');
                return row.slice(0, newCols);
            });

            section.tableData.cols = newCols;
            section.tableData.rows = newRows;

            if (!section.tableData.cellStyles) {
                section.tableData.cellStyles = {};
            }

            renderTableEditor(section);
            updatePreview();
        }

        function updateTableWidth(sectionId) {
            const section = sections.find(s => s.id === sectionId);
            if (!section) return;

            const newWidth = parseInt(document.getElementById(`tableWidth-${sectionId}`).value);
            section.tableData.width = newWidth;
            updatePreview();
        }

        function renderTableEditor(section) {
            const container = document.getElementById(`table-editor-${section.id}`);
            
            if (!section.tableData.mergeInfo) {
                section.tableData.mergeInfo = [];
            }
            if (!section.tableData.cellStyles) {
                section.tableData.cellStyles = {};
            }
            
            let html = '<div style="margin: 15px 0;"><strong>ë°ì´í„°:</strong> <span style="font-size: 12px; color: #666;">(ì…€ í´ë¦­ìœ¼ë¡œ ì„ íƒ)</span></div>';
            
            html += `
                <div style="margin-bottom: 10px;">
                    <button class="btn btn-primary" onclick="mergeSelectedCells(${section.id})" style="font-size: 12px; padding: 5px 10px;">
                        ë³‘í•©í•˜ê¸°
                    </button>
                    <button class="btn btn-secondary" onclick="toggleHeaderStyle(${section.id})" style="font-size: 12px; padding: 5px 10px;">
                        í—¤ë”ë¡œ ë³€ê²½
                    </button>
                    <button class="btn btn-secondary" onclick="clearSelection(${section.id})" style="font-size: 12px; padding: 5px 10px;">
                        ì„ íƒ í•´ì œ
                    </button>
                    <button class="btn btn-danger" onclick="unmergeCell(${section.id})" style="font-size: 12px; padding: 5px 10px;">
                        ë³‘í•© í•´ì œ
                    </button>
                </div>
            `;
            
            html += '<div id="table-grid-' + section.id + '" style="display: grid; grid-template-columns: repeat(' + section.tableData.cols + ', 1fr); gap: 5px;">';
            
            section.tableData.data.forEach((row, rowIdx) => {
                row.forEach((cell, cellIdx) => {
                    const cellId = `cell-${section.id}-${rowIdx}-${cellIdx}`;
                    const cellKey = `${rowIdx}-${cellIdx}`;
                    const isImage = cell && cell.startsWith('<img');
                    const isHeader = section.tableData.cellStyles[cellKey]?.isHeader || false;
                    
                    // ì´ë¯¸ì§€ í¬ê¸° ê°€ì ¸ì˜¤ê¸°
                    let imageWidth = '';
                    if (isImage && section.tableData.cellStyles[cellKey]?.imageWidth) {
                        imageWidth = section.tableData.cellStyles[cellKey].imageWidth;
                    }
                    
                    html += `
                        <div class="table-cell-wrapper" id="${cellId}-wrapper" 
                             onclick="toggleCellSelection(${section.id}, ${rowIdx}, ${cellIdx})"
                             style="cursor: pointer; border: 2px solid transparent; padding: 3px; border-radius: 4px; background: ${isHeader ? '#e8f5e9' : 'white'};">
                            ${isImage ? `
                                <div style="display: flex; align-items: center; gap: 5px; font-size: 11px; color: #666; margin-bottom: 2px;">
                                    <span>ğŸ–¼ï¸ ì´ë¯¸ì§€ ìˆìŒ</span>
                                    <input type="number" 
                                           id="imgWidth-${section.id}-${rowIdx}-${cellIdx}"
                                           value="${imageWidth}" 
                                           placeholder="ê°€ë¡œ(px)" 
                                           onclick="event.stopPropagation()"
                                           onchange="updateImageWidth(${section.id}, ${rowIdx}, ${cellIdx}, this.value)"
                                           style="width: 70px; padding: 2px 4px; font-size: 10px;">
                                </div>
                            ` : ''}
                            <input type="text" value="${isImage ? '' : cell}" 
                                   placeholder="ì…€ ${rowIdx + 1}-${cellIdx + 1}"
                                   onclick="event.stopPropagation()"
                                   onkeyup="updateTableCell(${section.id}, ${rowIdx}, ${cellIdx}, this.value)"
                                   style="background: transparent;">
                            <button onclick="event.stopPropagation(); addImageToTableCell(${section.id}, ${rowIdx}, ${cellIdx})" 
                                    style="position: absolute; right: 8px; top: ${isImage ? '40px' : '11px'}; font-size: 11px; padding: 2px 6px; border: 1px solid #ddd; background: white; cursor: pointer;">
                                ğŸ–¼ï¸
                            </button>
                        </div>
                    `;
                });
            });
            html += '</div>';

            container.innerHTML = html;
        }

        // í—¤ë” ìŠ¤íƒ€ì¼ í† ê¸€
        function toggleHeaderStyle(sectionId) {
            const cellSet = selectedCells.get(sectionId);
            if (!cellSet || cellSet.size === 0) {
                alert('ìŠ¤íƒ€ì¼ì„ ë³€ê²½í•  ì…€ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            const section = sections.find(s => s.id === sectionId);
            if (!section) return;

            cellSet.forEach(cellKey => {
                if (!section.tableData.cellStyles[cellKey]) {
                    section.tableData.cellStyles[cellKey] = {};
                }
                section.tableData.cellStyles[cellKey].isHeader = !section.tableData.cellStyles[cellKey].isHeader;
            });

            clearSelection(sectionId);
            renderTableEditor(section);
            updatePreview();
        }

        // ì…€ ì„ íƒ í† ê¸€
        const selectedCells = new Map(); // sectionId -> Set of "row-col"

        function toggleCellSelection(sectionId, row, col) {
            if (!selectedCells.has(sectionId)) {
                selectedCells.set(sectionId, new Set());
            }
            
            const cellSet = selectedCells.get(sectionId);
            const cellKey = `${row}-${col}`;
            const wrapper = document.getElementById(`cell-${sectionId}-${row}-${col}-wrapper`);
            
            if (cellSet.has(cellKey)) {
                cellSet.delete(cellKey);
                wrapper.style.border = '2px solid transparent';
            } else {
                cellSet.add(cellKey);
                wrapper.style.border = '2px solid var(--namu-green)';
            }
        }

        function clearSelection(sectionId) {
            const cellSet = selectedCells.get(sectionId);
            if (cellSet) {
                cellSet.forEach(cellKey => {
                    const [row, col] = cellKey.split('-').map(Number);
                    const wrapper = document.getElementById(`cell-${sectionId}-${row}-${col}-wrapper`);
                    if (wrapper) {
                        wrapper.style.border = '2px solid transparent';
                    }
                });
                cellSet.clear();
            }
        }

        function mergeSelectedCells(sectionId) {
            const cellSet = selectedCells.get(sectionId);
            if (!cellSet || cellSet.size < 2) {
                alert('ìµœì†Œ 2ê°œì˜ ì…€ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            const cells = Array.from(cellSet).map(key => {
                const [row, col] = key.split('-').map(Number);
                return { row, col };
            });

            // ì§ì‚¬ê°í˜• ì˜ì—­ì¸ì§€ í™•ì¸
            const rows = cells.map(c => c.row);
            const cols = cells.map(c => c.col);
            const minRow = Math.min(...rows);
            const maxRow = Math.max(...rows);
            const minCol = Math.min(...cols);
            const maxCol = Math.max(...cols);

            const expectedCells = (maxRow - minRow + 1) * (maxCol - minCol + 1);
            if (cells.length !== expectedCells) {
                alert('ì§ì‚¬ê°í˜• ì˜ì—­ë§Œ ë³‘í•©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                return;
            }

            const section = sections.find(s => s.id === sectionId);
            if (!section) return;

            // ë³‘í•© ì •ë³´ ì €ì¥
            const mergeInfo = {
                row: minRow,
                col: minCol,
                rowspan: maxRow - minRow + 1,
                colspan: maxCol - minCol + 1
            };

            // ê¸°ì¡´ ë³‘í•© ì •ë³´ ì¤‘ ê²¹ì¹˜ëŠ” ê²ƒ ì œê±°
            section.tableData.mergeInfo = section.tableData.mergeInfo.filter(m => {
                return !(m.row >= minRow && m.row <= maxRow && m.col >= minCol && m.col <= maxCol);
            });

            section.tableData.mergeInfo.push(mergeInfo);
            
            clearSelection(sectionId);
            renderTableEditor(section);
            updatePreview();
            alert('ë³‘í•©ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        function unmergeCell(sectionId) {
            const cellSet = selectedCells.get(sectionId);
            if (!cellSet || cellSet.size !== 1) {
                alert('ë³‘í•©ì„ í•´ì œí•  ì…€ 1ê°œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            const cellKey = Array.from(cellSet)[0];
            const [row, col] = cellKey.split('-').map(Number);
            
            const section = sections.find(s => s.id === sectionId);
            if (!section) return;

            // í•´ë‹¹ ì…€ì´ ì†í•œ ë³‘í•© ì •ë³´ ì°¾ê¸°
            const mergeIndex = section.tableData.mergeInfo.findIndex(m => 
                row >= m.row && row < m.row + m.rowspan &&
                col >= m.col && col < m.col + m.colspan
            );

            if (mergeIndex === -1) {
                alert('ë³‘í•©ëœ ì…€ì´ ì•„ë‹™ë‹ˆë‹¤.');
                return;
            }

            section.tableData.mergeInfo.splice(mergeIndex, 1);
            
            clearSelection(sectionId);
            renderTableEditor(section);
            updatePreview();
            alert('ë³‘í•©ì´ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        function updateImageWidth(sectionId, row, col, width) {
            const section = sections.find(s => s.id === sectionId);
            if (!section) return;

            const cellKey = `${row}-${col}`;
            if (!section.tableData.cellStyles[cellKey]) {
                section.tableData.cellStyles[cellKey] = {};
            }
            section.tableData.cellStyles[cellKey].imageWidth = width;
            
            updatePreview();
        }

        function addImageToTableCell(sectionId, rowIdx, cellIdx) {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        const section = sections.find(s => s.id === sectionId);
                        if (section) {
                            section.tableData.data[rowIdx][cellIdx] = `<img src="${event.target.result}" style="max-width: 150px; max-height: 150px;">`;
                            renderTableEditor(section);
                            updatePreview();
                        }
                    };
                    reader.readAsDataURL(file);
                }
            };
            
            input.click();
        }

        function updateTableHeader(sectionId, idx, value) {
            const section = sections.find(s => s.id === sectionId);
            if (section) {
                section.tableData.headers[idx] = value;
                updatePreview();
            }
        }

        function updateTableCell(sectionId, rowIdx, cellIdx, value) {
            const section = sections.find(s => s.id === sectionId);
            if (section) {
                // ì´ë¯¸ì§€ê°€ ì•„ë‹Œ ê²½ìš°ì—ë§Œ ì—…ë°ì´íŠ¸
                if (!section.tableData.data[rowIdx][cellIdx].startsWith('<img')) {
                    section.tableData.data[rowIdx][cellIdx] = value;
                    updatePreview();
                }
            }
        }

        // í…ìŠ¤íŠ¸ ì„œì‹ ì²˜ë¦¬
        function parseTextFormat(text) {
            if (!text) return '';
            
            // êµµê²Œ - *í…ìŠ¤íŠ¸*
            text = text.replace(/\*(.*?)\*/g, '<strong>$1</strong>');
            
            // ê°ì£¼ - {ì£¼ì„ë‚´ìš©} (ì„ì‹œ ë§ˆì»¤ ì‚¬ìš©)
            text = text.replace(/\{(.*?)\}/g, function(match, content) {
                footnotes.push(content);
                const escaped = content.replace(/"/g, '&quot;');
                return `<span style="color: var(--namu-green); cursor: help; font-size: 11px; vertical-align: super;" title="${escaped}">___FOOTNOTE_${footnotes.length}___</span>`;
            });
            
            // ëŒ€í‘œì»¬ëŸ¬ - [í…ìŠ¤íŠ¸]
            text = text.replace(/\[(.*?)\]/g, '<span style="color: var(--namu-green);">$1</span>');
            
            // ê°ì£¼ ë²ˆí˜¸ ë³µì›
            text = text.replace(/___FOOTNOTE_(\d+)___/g, '[$1]');
            
            // ì¤„ë°”ê¿ˆ
            text = text.replace(/\n/g, '<br>');
            
            // ë¶ˆë¦¿ ë¦¬ìŠ¤íŠ¸ - 2ë‹¨ (-- ë¨¼ì € ì²˜ë¦¬) (ì¤„ë°”ê¿ˆ í›„ ì²˜ë¦¬)
            text = text.replace(/<br>--\s*(.+?)(<br>|$)/g, '<br><div style="padding-left: 40px; position: relative;"><span style="position: absolute; left: 20px;">â—¦</span> $1</div>');
            text = text.replace(/^--\s*(.+?)(<br>|$)/, '<div style="padding-left: 40px; position: relative;"><span style="position: absolute; left: 20px;">â—¦</span> $1</div>');
            
            // ë¶ˆë¦¿ ë¦¬ìŠ¤íŠ¸ - 1ë‹¨ (ì¤„ë°”ê¿ˆ í›„ ì²˜ë¦¬)
            text = text.replace(/<br>-\s*(.+?)(<br>|$)/g, '<br><div style="padding-left: 20px; position: relative;"><span style="position: absolute; left: 0;">â€¢</span> $1</div>');
            text = text.replace(/^-\s*(.+?)(<br>|$)/, '<div style="padding-left: 20px; position: relative;"><span style="position: absolute; left: 0;">â€¢</span> $1</div>');
            
            // ì¸ìš© - ë°•ìŠ¤ ìŠ¤íƒ€ì¼ (ì¤„ë°”ê¿ˆ í›„ ì²˜ë¦¬)
            text = text.replace(/<br>>\s*(.+?)(<br>|$)/g, '<br><div style="display: inline-block; background: #f8f9fa; border: 1px solid #ddd; border-left: 4px solid var(--namu-green); padding: 10px; margin: 10px 0; color: #555;">$1</div>');
            text = text.replace(/^>\s*(.+?)(<br>|$)/, '<div style="display: inline-block; background: #f8f9fa; border: 1px solid #ddd; border-left: 4px solid var(--namu-green); padding: 10px; margin: 10px 0; color: #555;">$1</div>');
            
            return text;
        }

        // í”„ë¦¬ë·° ì—…ë°ì´íŠ¸
        function updatePreview() {
            const container = document.getElementById('dynamicContent');
            container.innerHTML = '';
            
            // ê°ì£¼ ì´ˆê¸°í™”
            footnotes = [];

            let headingCounters = [0, 0, 0, 0];
            let tocHTML = '';

            sections.forEach(section => {
                let sectionHTML = '';
                
                switch(section.type) {
                    case 'heading':
                        if (section.title) {
                            const level = parseInt(section.level);
                            headingCounters[level]++;
                            
                            for (let i = level + 1; i < headingCounters.length; i++) {
                                headingCounters[i] = 0;
                            }

                            let number = '';
                            for (let i = 1; i <= level; i++) {
                                number += (number ? '.' : '') + headingCounters[i];
                            }

                            const headingClass = level === 1 ? 'wiki-heading' : 
                                                 level === 2 ? 'wiki-heading wiki-heading-2' : 
                                                 'wiki-heading wiki-heading-3';
                            
                            const headingId = `section-${number.replace(/\./g, '-')}`;
                            
                            sectionHTML = `
                                <div class="wiki-section">
                                    <h${level + 1} class="${headingClass}" id="${headingId}">
                                        <span class="collapse-icon"></span>
                                        <span class="section-number">${number}.</span>${section.title}
                                    </h${level + 1}>
                                </div>
                            `;

                            const tocClass = `toc-level-${level}`;
                            tocHTML += `<li class="${tocClass}"><span class="toc-number">${number}.</span>${section.title}</li>`;
                        }
                        break;
                    case 'text':
                        if (section.content) {
                            sectionHTML = `<div class="wiki-text">${parseTextFormat(section.content)}</div>`;
                        }
                        break;
                    case 'collapse':
                        const linkText = section.collapseLink || 'ì´ê±° ì»¤ìŠ¤í…€';
                        sectionHTML = `
                            <div class="wiki-collapse" style="padding: 12px 0; margin: 15px 0; display: flex; align-items: center; gap: 10px;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" style="flex-shrink: 0; fill: #666;">
                                    <path d="M 6.5 2 C 5.1309372 2 4 3.1309372 4 4.5 L 4 19.5 C 4 20.869063 5.1309372 22 6.5 22 L 17.5 22 C 18.869063 22 20 20.869063 20 19.5 L 20 8 A 1.0001 1.0001 0 0 0 19.707031 7.2929688 L 14.707031 2.2929688 A 1.0001 1.0001 0 0 0 14 2 L 6.5 2 z M 6.5 4 L 13 4 L 13 8 A 1.0001 1.0001 0 0 0 14 9 L 18 9 L 18 19.5 C 18 19.786937 17.786937 20 17.5 20 L 6.5 20 C 6.2130628 20 6 19.786937 6 19.5 L 6 4.5 C 6 4.2130628 6.2130628 4 6.5 4 z M 15 5.4140625 L 16.585938 7 L 15 7 L 15 5.4140625 z M 9 10 A 1.0001 1.0001 0 1 0 9 12 L 15 12 A 1.0001 1.0001 0 1 0 15 10 L 9 10 z M 9 13 A 1.0001 1.0001 0 1 0 9 15 L 15 15 A 1.0001 1.0001 0 1 0 15 13 L 9 13 z M 9 16 A 1.0001 1.0001 0 1 0 9 18 L 13 18 A 1.0001 1.0001 0 1 0 13 16 L 9 16 z"></path>
                                </svg>
                                <span style="color: #222;">ìì„¸í•œ ë‚´ìš©ì€ <span style="color: var(--namu-green);">${linkText}</span> ë¬¸ì„œë¥¼ ì°¸ê³ í•˜ì‹­ì‹œì˜¤.</span>
                            </div>
                        `;
                        break;
                    case 'image':
                        const imgSrc = section.imageFile || section.imageUrl;
                        if (imgSrc) {
                            const widthStyle = section.imageWidth ? `style="width: ${section.imageWidth}px; height: auto; display: block; margin: 20px auto;"` : '';
                            sectionHTML = `<img src="${imgSrc}" class="wiki-image" alt="ì´ë¯¸ì§€" ${widthStyle}>`;
                        }
                        break;
                    case 'table':
                        if (section.tableData && section.tableData.data.length > 0) {
                            const tableWidth = section.tableData.width || 700;
                            sectionHTML = `<table class="wiki-table" style="max-width: ${tableWidth}px;"><tbody>`;
                            
                            const mergeInfo = section.tableData.mergeInfo || [];
                            const cellStyles = section.tableData.cellStyles || {};
                            const skippedCells = new Set();
                            
                            section.tableData.data.forEach((row, rowIdx) => {
                                sectionHTML += '<tr>';
                                row.forEach((cell, cellIdx) => {
                                    const cellKey = `${rowIdx}-${cellIdx}`;
                                    
                                    if (skippedCells.has(cellKey)) {
                                        return;
                                    }
                                    
                                    const merge = mergeInfo.find(m => m.row === rowIdx && m.col === cellIdx);
                                    const isHeader = cellStyles[cellKey]?.isHeader || false;
                                    
                                    let colspan = 1;
                                    let rowspan = 1;
                                    
                                    if (merge) {
                                        colspan = merge.colspan;
                                        rowspan = merge.rowspan;
                                        
                                        for (let r = rowIdx; r < rowIdx + rowspan; r++) {
                                            for (let c = cellIdx; c < cellIdx + colspan; c++) {
                                                if (r !== rowIdx || c !== cellIdx) {
                                                    skippedCells.add(`${r}-${c}`);
                                                }
                                            }
                                        }
                                    }
                                    
                                    const colspanAttr = colspan > 1 ? ` colspan="${colspan}"` : '';
                                    const rowspanAttr = rowspan > 1 ? ` rowspan="${rowspan}"` : '';
                                    const tag = isHeader ? 'th' : 'td';
                                    
                                    // ì´ë¯¸ì§€ í¬ê¸° ì ìš©
                                    let cellContent = cell || '';
                                    if (cellContent.startsWith('<img') && cellStyles[cellKey]?.imageWidth) {
                                        const width = cellStyles[cellKey].imageWidth;
                                        cellContent = cellContent.replace('<img', `<img style="width: ${width}px; height: auto;"`);
                                    }
                                    
                                    sectionHTML += `<${tag}${colspanAttr}${rowspanAttr}>${cellContent}</${tag}>`;
                                });
                                sectionHTML += '</tr>';
                            });
                            sectionHTML += '</tbody></table>';
                        }
                        break;
                }

                if (sectionHTML) {
                    container.innerHTML += sectionHTML;
                }
            });
            
            // ê°ì£¼ê°€ ìˆìœ¼ë©´ ë§¨ ì•„ë˜ ì¶”ê°€
            if (footnotes.length > 0) {
                let footnotesHTML = '<div class="wiki-footnotes" style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd;">';
                footnotesHTML += '<h3 style="font-size: 20px; font-weight: 700; margin-bottom: 15px;">ê°ì£¼</h3>';
                footnotesHTML += '<ol style="font-size: 14px; line-height: 1.8; padding-left: 20px;">';
                footnotes.forEach((note, index) => {
                    footnotesHTML += `<li id="fn-${index + 1}" style="margin-bottom: 8px;">${note}</li>`;
                });
                footnotesHTML += '</ol></div>';
                container.innerHTML += footnotesHTML;
            }

            document.getElementById('tocList').innerHTML = tocHTML || '<li style="color: #999;">ëª©ì°¨ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤</li>';
        }

        // ìº¡ì²˜ ê¸°ëŠ¥
        async function captureWiki() {
            const preview = document.getElementById('wiki-preview');
            try {
                const canvas = await html2canvas(preview, {
                    backgroundColor: '#ffffff',
                    scale: 1
                });
                
                const link = document.createElement('a');
                link.download = `wiki-${Date.now()}.png`;
                link.href = canvas.toDataURL();
                link.click();
                
                alert('âœ… ìº¡ì²˜ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
            } catch (error) {
                alert('âŒ ìº¡ì²˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                console.error(error);
            }
        }

        // ì €ì¥ ê¸°ëŠ¥
        function saveWiki() {
            const data = {
                pageTitle: document.getElementById('pageTitle').value,
                categories: document.getElementById('categories').value,
                lastModified: document.getElementById('lastModified').value,
                introImageUrl: document.getElementById('introImageUrl').value,
                introGroupNameEn: document.getElementById('introGroupNameEn').value,
                introGroupNameKo: document.getElementById('introGroupNameKo').value,
                introMembers: document.getElementById('introMembers').value,
                profileImageUrl: document.getElementById('profileImageUrl').value,
                profileRows: profileRows,
                sections: sections,
                theme: document.getElementById('themeColor').value
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `wiki-${Date.now()}.json`;
            link.click();
            URL.revokeObjectURL(url);
            
            alert('âœ… íŒŒì¼ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        // ë¶ˆëŸ¬ì˜¤ê¸° ê¸°ëŠ¥
        function loadWiki() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    try {
                        const data = JSON.parse(event.target.result);
                        
                        document.getElementById('pageTitle').value = data.pageTitle || '';
                        document.getElementById('categories').value = data.categories || '';
                        document.getElementById('lastModified').value = data.lastModified || '';
                        document.getElementById('introImageUrl').value = data.introImageUrl || '';
                        document.getElementById('introGroupNameEn').value = data.introGroupNameEn || '';
                        document.getElementById('introGroupNameKo').value = data.introGroupNameKo || '';
                        document.getElementById('introMembers').value = data.introMembers || '';
                        document.getElementById('profileImageUrl').value = data.profileImageUrl || '';
                        
                        if (data.theme) {
                            document.getElementById('themeColor').value = data.theme;
                            document.getElementById('themeColorText').value = data.theme;
                            applyTheme(data.theme);
                        }
                        
                        // í”„ë¡œí•„ ë³µì›
                        profileRows = data.profileRows || [];
                        profileRowCounter = Math.max(...profileRows.map(r => r.id), 0);
                        document.getElementById('profile-rows-list').innerHTML = '';
                        profileRows.forEach(row => renderProfileRowEditor(row));
                        updateProfilePreview();
                        
                        // ì„¹ì…˜ ë³µì›
                        sections = data.sections || [];
                        sectionCounter = Math.max(...sections.map(s => s.id), 0);
                        document.getElementById('sections-list').innerHTML = '';
                        sections.forEach(section => {
                            renderSectionEditor(section);
                            if (section.type === 'heading') {
                                document.getElementById(`level-${section.id}`).value = section.level;
                                document.getElementById(`title-${section.id}`).value = section.title;
                            } else if (section.type === 'text') {
                                document.getElementById(`content-${section.id}`).value = section.content;
                            } else if (section.type === 'image') {
                                document.getElementById(`imageUrl-${section.id}`).value = section.imageUrl || '';
                                if (section.imageFile) {
                                    document.getElementById(`imagePreview-${section.id}`).src = section.imageFile;
                                    document.getElementById(`imagePreview-${section.id}`).style.display = 'block';
                                }
                            } else if (section.type === 'table') {
                                document.getElementById(`tableCols-${section.id}`).value = section.tableData.cols;
                                document.getElementById(`tableRows-${section.id}`).value = section.tableData.rows;
                            }
                        });
                        
                        document.querySelector('.wiki-title').textContent = data.pageTitle;
                        
                        if (data.profileImageUrl) {
                            document.getElementById('previewProfileImage').innerHTML = 
                                `<img src="${data.profileImageUrl}" alt="í”„ë¡œí•„">`;
                        }
                        
                        // ë¶„ë¥˜ ë° ë©”íƒ€ ì •ë³´ ì—…ë°ì´íŠ¸
                        const cats = data.categories.split(',').map(c => c.trim()).filter(c => c);
                        let catsHTML = '<span style="color: #222; font-weight: normal;">ë¶„ë¥˜:</span> ';
                        catsHTML += cats.map(cat => `<span class="wiki-category-item">${cat}</span>`).join(' | ');
                        document.getElementById('wikiCategories').innerHTML = catsHTML;
                        document.getElementById('lastModifiedPreview').textContent = `ìµœê·¼ ìˆ˜ì •: ${data.lastModified}`;
                        
                        // íŠ¹ìˆ˜ í‘œ ë³µì›
                        if (data.introImageUrl) {
                            document.getElementById('introImagePreview').innerHTML = 
                                `<img src="${data.introImageUrl}" style="max-height: 60px; border-radius: 6px;">`;
                        }
                        document.getElementById('introGroupNameEnPreview').textContent = data.introGroupNameEn || '';
                        document.getElementById('introGroupNameKoPreview').textContent = data.introGroupNameKo || '';
                        const members = data.introMembers.split(',').map(m => m.trim()).filter(m => m);
                        const membersHTML = members.map(m => `<div class="member-item">${m}</div>`).join('');
                        document.getElementById('introMembersPreview').innerHTML = membersHTML;
                        
                        updatePreview();
                        alert('âœ… íŒŒì¼ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!');
                    } catch (error) {
                        alert('âŒ íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                        console.error(error);
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }

        // ì´ˆê¸°í™”
        initializeProfile();
        updatePreview();
    </script>
</body>
</html>
